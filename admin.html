<!DOCTYPE html>
<html lang="en">
<head>
<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADVERSE TECHNOLOGIES â€” Page Preloader v2
   Fixed: DOM injection, typewriter timing, guaranteed dismiss
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function () {
  'use strict';

  // â”€â”€ Already shown this session on this page? Skip. â”€â”€
  var pageKey = 'adv_shown_' + location.pathname;
  if (sessionStorage.getItem(pageKey)) return;

  // â”€â”€ Inject CSS immediately into <head> â”€â”€
  var style = document.createElement('style');
  style.textContent = [
    '#advPre{',
      'position:fixed;inset:0;z-index:99999;',
      'background:#050a06;',
      'display:flex;flex-direction:column;',
      'align-items:center;justify-content:center;',
      'font-family:"DM Sans","Helvetica Neue",Arial,sans-serif;',
      'transition:opacity 0.65s ease,visibility 0.65s ease;',
      'overflow:hidden;',
    '}',
    '#advPre.adv-out{opacity:0;visibility:hidden;pointer-events:none;}',

    /* grid */
    '#advPre::after{',
      'content:"";position:absolute;inset:0;',
      'background-image:',
        'linear-gradient(rgba(122,182,72,0.03) 1px,transparent 1px),',
        'linear-gradient(90deg,rgba(122,182,72,0.03) 1px,transparent 1px);',
      'background-size:48px 48px;pointer-events:none;',
    '}',

    /* ambient glow */
    '#advPre::before{',
      'content:"";position:absolute;inset:0;',
      'background:radial-gradient(ellipse 55% 45% at 50% 50%,rgba(122,182,72,0.05) 0%,transparent 70%);',
      'pointer-events:none;',
    '}',

    /* logo wrapper */
    '#advLogo{',
      'position:relative;z-index:2;',
      'margin-bottom:2.6rem;',
      'opacity:0;transform:scale(0.75);',
      'animation:advIn 0.55s cubic-bezier(0.34,1.56,0.64,1) 0.15s forwards;',
    '}',
    '@keyframes advIn{to{opacity:1;transform:scale(1);}}',

    /* pulse rings */
    '.advRing{',
      'position:absolute;border-radius:50%;',
      'border:1px solid rgba(122,182,72,0.14);',
      'animation:advPulse 2.2s ease infinite;',
    '}',
    '.advR1{inset:-16px;}',
    '.advR2{inset:-30px;border-color:rgba(122,182,72,0.07);animation-delay:0.5s;}',
    '@keyframes advPulse{0%,100%{opacity:0.4;transform:scale(1);}50%{opacity:1;transform:scale(1.05);}}',

    /* name */
    '#advName{',
      'position:relative;z-index:2;',
      'font-size:clamp(1.4rem,5vw,2.2rem);',
      'font-weight:300;',
      'letter-spacing:0.2em;',
      'text-transform:uppercase;',
      'color:#f0ede8;',
      'display:flex;align-items:center;justify-content:center;',
      'min-height:1.4em;',
      'margin-bottom:0;',
    '}',
    '#advPart1{color:#f0ede8;}',
    '#advPart2{color:#7ab648;font-weight:500;}',

    /* cursor */
    '#advCursor{',
      'display:inline-block;',
      'width:2px;height:0.9em;',
      'background:#7ab648;',
      'margin-left:4px;',
      'vertical-align:middle;',
      'animation:advBlink 0.8s step-end infinite;',
    '}',
    '@keyframes advBlink{0%,100%{opacity:1;}50%{opacity:0;}}',
    '#advCursor.adv-solid{animation:none;opacity:1;}',
    '#advCursor.adv-gone{display:none;}',

    /* tagline */
    '#advTag{',
      'position:relative;z-index:2;',
      'font-size:0.6rem;letter-spacing:0.28em;',
      'text-transform:uppercase;',
      'color:rgba(122,182,72,0.4);',
      'margin-top:1.5rem;',
      'opacity:0;transition:opacity 0.5s ease;',
    '}',
    '#advTag.adv-show{opacity:1;}',

    /* progress bar */
    '#advBar{position:absolute;bottom:0;left:0;right:0;height:2px;background:rgba(122,182,72,0.07);z-index:2;}',
    '#advFill{height:100%;width:0%;background:linear-gradient(90deg,#3a6a40,#7ab648,#9dd460);box-shadow:0 0 10px rgba(122,182,72,0.5);}',

    /* corner marks */
    '.advC{position:absolute;width:18px;height:18px;z-index:2;opacity:0.22;}',
    '.advTL{top:1.4rem;left:1.4rem;border-top:1px solid #7ab648;border-left:1px solid #7ab648;}',
    '.advTR{top:1.4rem;right:1.4rem;border-top:1px solid #7ab648;border-right:1px solid #7ab648;}',
    '.advBL{bottom:1.4rem;left:1.4rem;border-bottom:1px solid #7ab648;border-left:1px solid #7ab648;}',
    '.advBR{bottom:1.4rem;right:1.4rem;border-bottom:1px solid #7ab648;border-right:1px solid #7ab648;}',

    /* version */
    '#advVer{position:absolute;bottom:1.2rem;right:1.8rem;font-size:0.55rem;letter-spacing:0.14em;color:rgba(122,182,72,0.18);z-index:2;}',
  ].join('');
  document.head.appendChild(style);

  // â”€â”€ Build the overlay HTML â”€â”€
  var html = [
    '<div class="advC advTL"></div>',
    '<div class="advC advTR"></div>',
    '<div class="advC advBL"></div>',
    '<div class="advC advBR"></div>',

    '<div id="advLogo">',
      '<div class="advRing advR1"></div>',
      '<div class="advRing advR2"></div>',
      '<svg width="86" height="86" viewBox="0 0 88 88" fill="none" xmlns="http://www.w3.org/2000/svg">',
        '<circle cx="44" cy="44" r="42" stroke="rgba(122,182,72,0.16)" stroke-width="1"/>',
        '<circle cx="44" cy="44" r="33" stroke="rgba(122,182,72,0.07)" stroke-width="1"/>',
        /* A shape */
        '<path d="M24 68 L44 18 L64 68" stroke="#7ab648" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>',
        '<path d="M32 52 L56 52" stroke="#7ab648" stroke-width="2" stroke-linecap="round"/>',
        '<circle cx="32" cy="52" r="2.5" fill="#7ab648"/>',
        '<circle cx="56" cy="52" r="2.5" fill="#7ab648"/>',
        '<circle cx="44" cy="18" r="2" fill="#9dd460"/>',
        /* circuit legs */
        '<path d="M24 68 L17 68 L17 61" stroke="rgba(122,182,72,0.3)" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/>',
        '<path d="M64 68 L71 68 L71 61" stroke="rgba(122,182,72,0.3)" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/>',
        '<rect x="15" y="59" width="4" height="4" rx="1" fill="rgba(122,182,72,0.28)"/>',
        '<rect x="69" y="59" width="4" height="4" rx="1" fill="rgba(122,182,72,0.28)"/>',
        '<line x1="9" y1="44" x2="17" y2="44" stroke="rgba(122,182,72,0.18)" stroke-width="1"/>',
        '<line x1="71" y1="44" x2="79" y2="44" stroke="rgba(122,182,72,0.18)" stroke-width="1"/>',
      '</svg>',
    '</div>',

    '<div id="advName">',
      '<span id="advPart1"></span>',
      '<span id="advPart2"></span>',
      '<span id="advCursor"></span>',
    '</div>',

    '<div id="advTag">Powered by Adverse Technologies &middot; Uganda</div>',

    '<div id="advBar"><div id="advFill"></div></div>',
    '<div id="advVer">ADV &middot; 2026</div>',
  ].join('');

  // â”€â”€ Inject overlay into body as soon as body is available â”€â”€
  function inject() {
    var overlay = document.createElement('div');
    overlay.id = 'advPre';
    overlay.innerHTML = html;
    // Prepend before everything
    if (document.body.firstChild) {
      document.body.insertBefore(overlay, document.body.firstChild);
    } else {
      document.body.appendChild(overlay);
    }
    startSequence();
  }

  // Body may or may not exist yet when this script runs from <head>
  if (document.body) {
    inject();
  } else {
    // Wait for body â€” use a tiny interval (faster than DOMContentLoaded)
    var bodyWait = setInterval(function () {
      if (document.body) {
        clearInterval(bodyWait);
        inject();
      }
    }, 5);
  }

  // â”€â”€ TYPEWRITER â”€â”€
  function typeWord(elId, text, speed, done) {
    var el = document.getElementById(elId);
    if (!el) { done && done(); return; }
    var i = 0;
    function tick() {
      if (i <= text.length) {
        el.textContent = text.slice(0, i);
        i++;
        // Slight human jitter
        setTimeout(tick, speed + (Math.random() * 28 - 10));
      } else {
        done && done();
      }
    }
    tick();
  }

  // â”€â”€ PROGRESS BAR â”€â”€
  function runBar(ms) {
    var fill = document.getElementById('advFill');
    if (!fill) return;
    var start = Date.now();
    function step() {
      var pct = Math.min(90, ((Date.now() - start) / ms) * 90);
      fill.style.width = pct + '%';
      if (pct < 90) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  }

  // â”€â”€ DISMISS â”€â”€
  function dismiss() {
    var overlay = document.getElementById('advPre');
    if (!overlay || overlay.dataset.dismissed) return;
    overlay.dataset.dismissed = '1';

    // Complete the bar
    var fill = document.getElementById('advFill');
    if (fill) { fill.style.transition = 'width 0.3s ease'; fill.style.width = '100%'; }

    setTimeout(function () {
      overlay.classList.add('adv-out');
      setTimeout(function () {
        if (overlay.parentNode) overlay.parentNode.removeChild(overlay);
        // Also kill site's own loadSplash if on index
        var splash = document.getElementById('loadSplash');
        if (splash) splash.classList.add('hidden');
      }, 700);
    }, 300);

    sessionStorage.setItem(pageKey, '1');
  }

  // â”€â”€ MAIN SEQUENCE â”€â”€
  function startSequence() {
    // Safety: always dismiss after 5 seconds no matter what
    var safetyTimer = setTimeout(dismiss, 5000);

    // Start progress bar over 3 seconds
    runBar(3000);

    // Wait for logo animation (0.7s) then start typing
    setTimeout(function () {

      // Type "Adverse" at ~85ms per char
      typeWord('advPart1', 'Adverse', 85, function () {

        // Pause 550ms â€” cursor blinks on its own here
        setTimeout(function () {

          // Type " Technologies" at ~58ms per char in green
          typeWord('advPart2', '\u00a0Technologies', 58, function () {

            // Done typing â€” freeze cursor
            var cursor = document.getElementById('advCursor');
            if (cursor) cursor.classList.add('adv-solid');

            // Show tagline
            var tag = document.getElementById('advTag');
            if (tag) tag.classList.add('adv-show');

            // Hold 600ms then dismiss
            setTimeout(function () {
              clearTimeout(safetyTimer);
              var cursor2 = document.getElementById('advCursor');
              if (cursor2) cursor2.classList.add('adv-gone');
              dismiss();
            }, 600);

          });
        }, 550);
      });
    }, 700);
  }

})();

</script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0d2818">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Elite Trees">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152.png">
  <link rel="apple-touch-icon" sizes="144x144" href="icons/icon-144.png">
  <link rel="apple-touch-icon" sizes="128x128" href="icons/icon-128.png">
<title>Admin â€” Elite Tree Solutions</title>
<meta name="robots" content="noindex, nofollow">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{
  --forest:#0d2818;--moss:#1a4a2e;--sage:#4a7c59;
  --leaf:#7ab648;--gold:#c8a96e;--cream:#f5f0e8;--mist:#e8f0e4;
  --red:#e53935;--amber:#f59e0b;--blue:#3b82f6;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'DM Sans',sans-serif;background:#f0f4f0;color:var(--forest);min-height:100vh;}

/* â”€â”€ LOGIN â”€â”€ */
#loginScreen{
  position:fixed;inset:0;background:radial-gradient(ellipse 70% 70% at 50% 50%,#1a4a2e,#0d2818);
  display:flex;align-items:center;justify-content:center;z-index:1000;
}
.login-box{
  background:rgba(255,255,255,0.05);border:1px solid rgba(122,182,72,0.2);
  border-radius:1.5rem;padding:3rem;width:100%;max-width:380px;text-align:center;
  backdrop-filter:blur(20px);
}
.login-logo{font-family:'Playfair Display',serif;font-size:1.4rem;color:var(--cream);margin-bottom:0.3rem;}
.login-sub{font-size:0.75rem;color:var(--sage);margin-bottom:2rem;text-transform:uppercase;letter-spacing:0.1em;}
.login-box input{
  width:100%;padding:0.9rem 1rem;border:1.5px solid rgba(122,182,72,0.2);
  border-radius:0.7rem;background:rgba(255,255,255,0.05);
  color:var(--cream);font-family:'DM Sans',sans-serif;font-size:0.9rem;
  outline:none;margin-bottom:1rem;transition:border-color 0.3s;
}
.login-box input::placeholder{color:rgba(245,240,232,0.3);}
.login-box input:focus{border-color:var(--leaf);}
.login-btn{
  width:100%;padding:0.9rem;background:var(--leaf);color:var(--forest);
  border:none;border-radius:0.7rem;font-family:'DM Sans',sans-serif;
  font-size:0.95rem;font-weight:600;cursor:pointer;transition:all 0.3s;
}
.login-btn:hover{background:var(--gold);}
.login-error{color:#ef5350;font-size:0.8rem;margin-top:0.5rem;display:none;}
.login-hint{font-size:0.7rem;color:rgba(245,240,232,0.2);margin-top:1.5rem;line-height:1.6;}

/* â”€â”€ ADMIN LAYOUT â”€â”€ */
#adminScreen{display:none;}
.admin-nav{
  background:var(--forest);padding:1rem 2rem;
  display:flex;align-items:center;justify-content:space-between;gap:1rem;
  position:sticky;top:0;z-index:100;border-bottom:1px solid rgba(122,182,72,0.15);
  flex-wrap:wrap;
}
.admin-nav-logo{font-family:'Playfair Display',serif;color:var(--cream);font-size:1rem;white-space:nowrap;}
.admin-nav-logo span{color:var(--leaf);}
.admin-tabs{display:flex;gap:0.4rem;flex-wrap:wrap;}
.admin-tab{
  padding:0.4rem 0.9rem;border-radius:1rem;border:1px solid rgba(122,182,72,0.2);
  background:transparent;color:rgba(245,240,232,0.6);font-family:'DM Sans',sans-serif;
  font-size:0.78rem;cursor:pointer;transition:all 0.2s;white-space:nowrap;
}
.admin-tab.active,.admin-tab:hover{background:var(--leaf);color:var(--forest);border-color:var(--leaf);}
.logout-btn{
  padding:0.4rem 1rem;background:rgba(229,115,115,0.15);border:1px solid rgba(229,115,115,0.3);
  color:#ef9a9a;border-radius:1rem;font-size:0.75rem;cursor:pointer;
  font-family:'DM Sans',sans-serif;transition:all 0.2s;white-space:nowrap;
}
.logout-btn:hover{background:rgba(229,115,115,0.25);}

.admin-body{padding:2rem;max-width:1200px;margin:0 auto;}

/* â”€â”€ PANELS â”€â”€ */
.panel{display:none;}
.panel.active{display:block;}
.panel-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;flex-wrap:wrap;gap:1rem;}
.panel-title{font-family:'Playfair Display',serif;font-size:1.4rem;color:var(--forest);}

/* â”€â”€ BUTTONS â”€â”€ */
.btn-primary{padding:0.65rem 1.4rem;background:var(--leaf);color:var(--forest);border:none;border-radius:0.6rem;font-family:'DM Sans',sans-serif;font-size:0.85rem;font-weight:600;cursor:pointer;transition:all 0.3s;}
.btn-primary:hover{background:var(--forest);color:var(--leaf);}
.btn-danger{padding:0.5rem 0.9rem;background:rgba(229,57,53,0.1);color:var(--red);border:1px solid rgba(229,57,53,0.2);border-radius:0.5rem;font-family:'DM Sans',sans-serif;font-size:0.78rem;cursor:pointer;transition:all 0.2s;}
.btn-danger:hover{background:rgba(229,57,53,0.2);}
.btn-edit{padding:0.5rem 0.9rem;background:rgba(122,182,72,0.1);color:var(--sage);border:1px solid rgba(122,182,72,0.2);border-radius:0.5rem;font-family:'DM Sans',sans-serif;font-size:0.78rem;cursor:pointer;transition:all 0.2s;}
.btn-edit:hover{background:var(--mist);}

/* â”€â”€ STATS â”€â”€ */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:2rem;}
.stat-card{background:white;border-radius:1rem;padding:1.4rem;border:1px solid rgba(13,40,24,0.07);}
.stat-val{font-family:'Playfair Display',serif;font-size:2rem;font-weight:900;color:var(--forest);line-height:1;}
.stat-label{font-size:0.72rem;color:var(--sage);margin-top:0.3rem;text-transform:uppercase;letter-spacing:0.06em;}
.stat-change{font-size:0.7rem;color:var(--leaf);margin-top:0.3rem;}

/* â”€â”€ PHOTO MANAGER â”€â”€ */
.photo-intro{
  background:var(--forest);border-radius:1.2rem;padding:2rem;margin-bottom:2rem;
  border:1px solid rgba(122,182,72,0.15);
}
.photo-intro h3{font-family:'Playfair Display',serif;color:var(--cream);font-size:1.2rem;margin-bottom:0.5rem;}
.photo-intro p{font-size:0.83rem;color:rgba(245,240,232,0.55);line-height:1.7;}
.how-it-works{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-top:1.5rem;}
.how-step{text-align:center;}
.how-num{width:32px;height:32px;border-radius:50%;background:rgba(122,182,72,0.15);border:1px solid rgba(122,182,72,0.3);color:var(--leaf);font-family:'Playfair Display',serif;font-weight:700;font-size:0.9rem;display:flex;align-items:center;justify-content:center;margin:0 auto 0.6rem;}
.how-text{font-size:0.73rem;color:rgba(245,240,232,0.5);line-height:1.5;}

.photo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1.2rem;}
.photo-card{background:white;border-radius:1rem;overflow:hidden;border:1px solid rgba(13,40,24,0.07);transition:box-shadow 0.3s;}
.photo-card:hover{box-shadow:0 8px 24px rgba(13,40,24,0.1);}
.photo-card-thumb{
  height:150px;position:relative;overflow:hidden;
  background:linear-gradient(135deg,#1a4a2e,#0d2818);
  display:flex;align-items:center;justify-content:center;
}
.photo-card-thumb img{width:100%;height:100%;object-fit:cover;display:block;}
.photo-card-thumb.has-photo::after{
  content:'âœ“ Photo set';position:absolute;top:0.5rem;right:0.5rem;
  background:rgba(122,182,72,0.9);color:white;font-size:0.6rem;
  padding:0.2rem 0.5rem;border-radius:1rem;font-weight:600;
}
.photo-card-thumb.no-photo{cursor:pointer;}
.photo-card-thumb.no-photo:hover{background:linear-gradient(135deg,#2a6a3e,#1a3828);}
.photo-placeholder-icon{text-align:center;}
.photo-placeholder-icon div{font-size:1.8rem;margin-bottom:0.4rem;}
.photo-placeholder-icon p{font-size:0.68rem;color:rgba(245,240,232,0.4);}
.photo-card-body{padding:1rem;}
.photo-card-name{font-family:'Playfair Display',serif;font-size:0.95rem;color:var(--forest);font-weight:700;margin-bottom:0.2rem;}
.photo-card-cat{font-size:0.65rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--sage);margin-bottom:0.8rem;}
.photo-card-actions{display:flex;gap:0.5rem;flex-wrap:wrap;}
.photo-upload-btn{
  flex:1;padding:0.5rem;background:rgba(122,182,72,0.08);border:1.5px dashed rgba(122,182,72,0.3);
  border-radius:0.5rem;color:var(--sage);font-size:0.73rem;cursor:pointer;
  font-family:'DM Sans',sans-serif;transition:all 0.2s;text-align:center;
}
.photo-upload-btn:hover{background:rgba(122,182,72,0.15);border-color:var(--leaf);color:var(--leaf);}
.photo-url-btn{
  flex:1;padding:0.5rem;background:rgba(59,130,246,0.08);border:1.5px solid rgba(59,130,246,0.2);
  border-radius:0.5rem;color:var(--blue);font-size:0.73rem;cursor:pointer;
  font-family:'DM Sans',sans-serif;transition:all 0.2s;text-align:center;
}
.photo-url-btn:hover{background:rgba(59,130,246,0.15);}
.photo-clear-btn{
  padding:0.5rem 0.8rem;background:rgba(229,57,53,0.06);border:1px solid rgba(229,57,53,0.15);
  border-radius:0.5rem;color:rgba(229,57,53,0.6);font-size:0.73rem;cursor:pointer;
  font-family:'DM Sans',sans-serif;transition:all 0.2s;
}
.photo-clear-btn:hover{background:rgba(229,57,53,0.12);}

/* â”€â”€ CODE GENERATOR â”€â”€ */
.code-panel{background:white;border-radius:1.2rem;padding:1.8rem;margin-top:2rem;border:1px solid rgba(13,40,24,0.07);}
.code-panel h3{font-family:'Playfair Display',serif;font-size:1.1rem;color:var(--forest);margin-bottom:0.5rem;}
.code-panel p{font-size:0.82rem;color:var(--sage);margin-bottom:1.2rem;line-height:1.6;}
.code-block{
  background:#0d2818;color:#9dd460;padding:1.2rem 1.4rem;border-radius:0.8rem;
  font-family:'IBM Plex Mono',monospace;font-size:0.78rem;line-height:1.8;
  overflow-x:auto;position:relative;white-space:pre;
}
.code-copy-btn{
  position:absolute;top:0.8rem;right:0.8rem;
  background:rgba(122,182,72,0.15);border:1px solid rgba(122,182,72,0.25);
  color:var(--leaf);padding:0.3rem 0.8rem;border-radius:0.4rem;
  font-family:'DM Sans',sans-serif;font-size:0.7rem;cursor:pointer;transition:all 0.2s;
}
.code-copy-btn:hover{background:rgba(122,182,72,0.3);}
.github-steps{margin-top:1.5rem;}
.github-step{
  display:flex;gap:1rem;align-items:flex-start;padding:0.8rem 0;
  border-bottom:1px solid rgba(13,40,24,0.05);
}
.github-step:last-child{border-bottom:none;}
.step-num{
  width:26px;height:26px;border-radius:50%;background:rgba(122,182,72,0.12);
  color:var(--leaf);font-size:0.75rem;font-weight:700;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;margin-top:0.1rem;
}
.step-text{font-size:0.82rem;color:var(--sage);line-height:1.6;}
.step-text strong{color:var(--forest);}
.step-text code{background:var(--mist);padding:0.1rem 0.4rem;border-radius:0.3rem;font-family:'IBM Plex Mono',monospace;font-size:0.78rem;}

/* â”€â”€ TREE TABLE â”€â”€ */
.tree-table{width:100%;border-collapse:collapse;background:white;border-radius:1rem;overflow:hidden;box-shadow:0 2px 12px rgba(13,40,24,0.06);}
.tree-table th{background:var(--forest);color:rgba(245,240,232,0.7);padding:0.9rem 1rem;text-align:left;font-size:0.7rem;text-transform:uppercase;letter-spacing:0.08em;font-weight:500;}
.tree-table td{padding:0.85rem 1rem;border-bottom:1px solid rgba(13,40,24,0.05);font-size:0.83rem;color:var(--forest);vertical-align:middle;}
.tree-table tr:last-child td{border-bottom:none;}
.tree-table tr:hover td{background:rgba(232,240,228,0.3);}
.tree-thumb-mini{width:40px;height:40px;border-radius:0.5rem;overflow:hidden;flex-shrink:0;}
.tree-thumb-mini img{width:100%;height:100%;object-fit:cover;}
.cat-badge{display:inline-block;padding:0.2rem 0.6rem;border-radius:1rem;font-size:0.66rem;font-weight:500;text-transform:capitalize;}
.cat-fruit{background:#fff3e0;color:#e65100;}
.cat-shade{background:#e8f5e9;color:#2e7d32;}
.cat-ornamental{background:#f3e5f5;color:#6a1b9a;}
.cat-native{background:#e3f2fd;color:#1565c0;}
.cat-palm{background:#fce4ec;color:#880e4f;}
.price-cell{font-family:'Playfair Display',serif;font-weight:700;}
.action-btns{display:flex;gap:0.4rem;flex-wrap:wrap;}

.table-toolbar{display:flex;gap:1rem;margin-bottom:1rem;align-items:center;flex-wrap:wrap;}
.search-bar{position:relative;flex:1;min-width:200px;}
.search-bar input{width:100%;padding:0.65rem 0.9rem 0.65rem 2.4rem;border:1.5px solid rgba(13,40,24,0.1);border-radius:0.6rem;font-family:'DM Sans',sans-serif;font-size:0.85rem;outline:none;color:var(--forest);transition:border-color 0.3s;}
.search-bar input:focus{border-color:var(--leaf);}
.search-bar svg{position:absolute;left:0.7rem;top:50%;transform:translateY(-50%);}
.filter-select{padding:0.65rem 0.9rem;border:1.5px solid rgba(13,40,24,0.1);border-radius:0.6rem;font-family:'DM Sans',sans-serif;font-size:0.85rem;color:var(--forest);outline:none;background:white;}

/* â”€â”€ MODAL â”€â”€ */
.modal-backdrop{position:fixed;inset:0;background:rgba(7,15,10,0.7);z-index:500;display:none;align-items:center;justify-content:center;padding:1rem;}
.modal-backdrop.open{display:flex;}
.modal-box{background:white;border-radius:1.5rem;padding:2.5rem;width:100%;max-width:580px;max-height:90vh;overflow-y:auto;position:relative;}
.modal-box h3{font-family:'Playfair Display',serif;font-size:1.3rem;color:var(--forest);margin-bottom:1.5rem;}
.modal-close{position:absolute;top:1.2rem;right:1.2rem;background:var(--mist);border:none;width:32px;height:32px;border-radius:50%;cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;}
.form-group{display:flex;flex-direction:column;gap:0.4rem;}
.form-group.full{grid-column:1/-1;}
.form-group label{font-size:0.7rem;text-transform:uppercase;letter-spacing:0.08em;color:var(--sage);}
.form-group input,.form-group select,.form-group textarea{padding:0.75rem 0.9rem;border:1.5px solid rgba(13,40,24,0.12);border-radius:0.6rem;font-family:'DM Sans',sans-serif;font-size:0.88rem;color:var(--forest);outline:none;transition:border-color 0.3s;}
.form-group input:focus,.form-group select:focus{border-color:var(--leaf);}
.color-row{display:flex;gap:0.8rem;align-items:center;}
.color-row input[type=color]{width:48px;height:38px;border:1.5px solid rgba(13,40,24,0.12);border-radius:0.5rem;cursor:pointer;padding:2px;}
.tree-preview{border:2px dashed rgba(13,40,24,0.12);border-radius:0.8rem;padding:1rem;text-align:center;margin-bottom:1rem;background:var(--mist);}
.tree-preview p{font-size:0.72rem;color:var(--sage);margin-top:0.4rem;}

/* â”€â”€ URL MODAL â”€â”€ */
.url-modal-box{background:white;border-radius:1.2rem;padding:2rem;width:100%;max-width:460px;position:relative;}
.url-modal-box h3{font-family:'Playfair Display',serif;font-size:1.1rem;color:var(--forest);margin-bottom:0.5rem;}
.url-modal-box p{font-size:0.8rem;color:var(--sage);margin-bottom:1rem;line-height:1.6;}
.url-modal-box input{width:100%;padding:0.75rem 0.9rem;border:1.5px solid rgba(13,40,24,0.12);border-radius:0.6rem;font-family:'DM Sans',sans-serif;font-size:0.85rem;outline:none;color:var(--forest);margin-bottom:1rem;}
.url-modal-box input:focus{border-color:var(--leaf);}
.url-preview-img{width:100%;height:120px;object-fit:cover;border-radius:0.5rem;margin-bottom:0.8rem;display:none;}

/* â”€â”€ SETTINGS â”€â”€ */
.settings-card{background:white;border-radius:1rem;padding:1.8rem;margin-bottom:1.2rem;border:1px solid rgba(13,40,24,0.07);}
.settings-card h4{font-family:'Playfair Display',serif;font-size:1rem;color:var(--forest);margin-bottom:0.3rem;}
.settings-card p{font-size:0.82rem;color:var(--sage);margin-bottom:1.2rem;line-height:1.6;}
.settings-row{display:flex;gap:1rem;align-items:center;margin-bottom:0.8rem;flex-wrap:wrap;}
.settings-row input{flex:1;min-width:200px;padding:0.7rem 0.9rem;border:1.5px solid rgba(13,40,24,0.12);border-radius:0.6rem;font-family:'DM Sans',sans-serif;font-size:0.85rem;outline:none;color:var(--forest);}
.settings-row input:focus{border-color:var(--leaf);}
.save-btn{padding:0.7rem 1.4rem;background:var(--leaf);color:var(--forest);border:none;border-radius:0.6rem;font-family:'DM Sans',sans-serif;font-weight:600;cursor:pointer;white-space:nowrap;transition:all 0.3s;}
.save-btn:hover{background:var(--forest);color:var(--leaf);}

/* â”€â”€ ORDERS â”€â”€ */
.order-card{background:white;border-radius:1rem;padding:1.4rem;border:1px solid rgba(13,40,24,0.07);border-left:4px solid var(--gold);margin-bottom:1rem;}
.order-card.completed{border-left-color:var(--leaf);}
.order-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.8rem;flex-wrap:wrap;gap:0.5rem;}
.order-id{font-family:'Playfair Display',serif;font-size:0.9rem;font-weight:700;color:var(--forest);}
.order-status{font-size:0.7rem;padding:0.2rem 0.7rem;border-radius:1rem;font-weight:500;}
.status-pending{background:#fff3cd;color:#856404;}
.status-completed{background:#d4edda;color:#155724;}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:2rem;left:50%;transform:translateX(-50%) translateY(80px);background:var(--forest);color:var(--leaf);padding:0.8rem 1.8rem;border-radius:2rem;font-size:0.85rem;font-weight:500;z-index:9999;transition:transform 0.4s ease;border:1px solid rgba(122,182,72,0.3);white-space:nowrap;}
.toast.show{transform:translateX(-50%) translateY(0);}

@media(max-width:900px){.stats-row{grid-template-columns:1fr 1fr;}.photo-grid{grid-template-columns:1fr 1fr;}.how-it-works{grid-template-columns:1fr 1fr;}}
@media(max-width:600px){.stats-row{grid-template-columns:1fr 1fr;}.photo-grid{grid-template-columns:1fr;}.form-grid{grid-template-columns:1fr;}.admin-body{padding:1rem;}.how-it-works{grid-template-columns:1fr 1fr;}}
</style>
</head>
<body>

<!-- â•â• LOGIN â•â• -->
<div id="loginScreen">
  <div class="login-box">
    <div style="font-size:2.5rem;margin-bottom:1rem;">ğŸŒ³</div>
    <div class="login-logo">Elite Tree Solutions</div>
    <div class="login-sub">Admin Panel Â· Owner Access Only</div>
    <input type="password" id="loginPass" placeholder="Enter your password" onkeydown="if(event.key==='Enter')doLogin()">
    <button class="login-btn" onclick="doLogin()">Sign In â†’</button>
    <div class="login-error" id="loginError">âŒ Incorrect password. Try again.</div>
    <div class="login-hint">Owned by Kabuye Hitler Musujja<br>Default password: <strong style="color:rgba(122,182,72,0.6);">EliteTree2024</strong><br>Change it in Settings after first login.</div>
  </div>
</div>

<!-- â•â• ADMIN â•â• -->
<div id="adminScreen">
  <nav class="admin-nav">
    <div class="admin-nav-logo">ğŸŒ³ <span>Elite Tree</span> Admin</div>
    <div class="admin-tabs">
      <button class="admin-tab active" onclick="showPanel('dashboard',this)">ğŸ“Š Dashboard</button>
      <button class="admin-tab" onclick="showPanel('photos',this)">ğŸ“· Photos</button>
      <button class="admin-tab" onclick="showPanel('trees',this)">ğŸŒ³ Trees</button>
      <button class="admin-tab" onclick="showPanel('orders',this)">ğŸ›’ Orders</button>
      <button class="admin-tab" onclick="showPanel('settings',this)">âš™ï¸ Settings</button>
    </div>
    <button class="logout-btn" onclick="logout()">Log Out</button>
  </nav>

  <div class="admin-body">

    <!-- â•â• DASHBOARD â•â• -->
    <div class="panel active" id="panel-dashboard">
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-val" id="stat-trees">42</div>
          <div class="stat-label">Tree Species</div>
          <div class="stat-change">â†‘ Manage in Trees tab</div>
        </div>
        <div class="stat-card">
          <div class="stat-val" id="stat-photos">0</div>
          <div class="stat-label">Photos Added</div>
          <div class="stat-change">â†‘ Add in Photos tab</div>
        </div>
        <div class="stat-card">
          <div class="stat-val" id="stat-orders">0</div>
          <div class="stat-label">Orders Recorded</div>
          <div class="stat-change">Via WhatsApp & MoMo</div>
        </div>
        <div class="stat-card">
          <div class="stat-val">12</div>
          <div class="stat-label">Site Pages Live</div>
          <div class="stat-change">All pages deployed</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.2rem;">
        <div style="background:white;border-radius:1rem;padding:1.5rem;border:1px solid rgba(13,40,24,0.07);">
          <div style="font-family:'Playfair Display',serif;font-size:1rem;margin-bottom:1rem;color:var(--forest);">Quick Actions</div>
          <div style="display:flex;flex-direction:column;gap:0.7rem;">
            <button class="btn-primary" onclick="showPanel('photos',document.querySelectorAll('.admin-tab')[1])">ğŸ“· Manage Tree Photos</button>
            <button class="btn-primary" onclick="showPanel('trees',document.querySelectorAll('.admin-tab')[2])">+ Add New Tree Species</button>
            <a href="shop.html" target="_blank" class="btn-primary" style="display:block;text-align:center;text-decoration:none;background:var(--moss);">ğŸ›’ Preview Live Shop</a>
            <a href="adverse.html" target="_blank" class="btn-primary" style="display:block;text-align:center;text-decoration:none;background:var(--moss);">ğŸŒ¿ Test Adverse AI</a>
          </div>
        </div>
        <div style="background:white;border-radius:1rem;padding:1.5rem;border:1px solid rgba(13,40,24,0.07);">
          <div style="font-family:'Playfair Display',serif;font-size:1rem;margin-bottom:1rem;color:var(--forest);">Site Status</div>
          <div style="display:flex;flex-direction:column;gap:0.6rem;font-size:0.83rem;">
            <div style="display:flex;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid rgba(13,40,24,0.05);">
              <span>ğŸ“± MTN MoMo</span><span style="color:var(--leaf);font-weight:600;">âœ… Active</span>
            </div>
            <div style="display:flex;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid rgba(13,40,24,0.05);">
              <span>ğŸ“² Airtel Money</span><span style="color:var(--leaf);font-weight:600;">âœ… Active</span>
            </div>
            <div style="display:flex;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid rgba(13,40,24,0.05);">
              <span>ğŸŒ International Transfer</span><span style="color:var(--leaf);font-weight:600;">âœ… Active</span>
            </div>
            <div style="display:flex;justify-content:space-between;padding:0.5rem 0;">
              <span>ğŸŒ¿ Adverse AI</span><span style="color:var(--leaf);font-weight:600;">âœ… Live</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â• PHOTO MANAGER â•â• -->
    <div class="panel" id="panel-photos">
      <div class="panel-header">
        <div class="panel-title">ğŸ“· Photo Manager</div>
        <button class="btn-primary" onclick="generateAllCode()">â¬‡ Generate shop.html Code</button>
      </div>

      <!-- How it works -->
      <div class="photo-intro">
        <h3>How Photo Manager Works</h3>
        <p>Because the website is hosted on GitHub (not a server), photos can't be uploaded directly from here. Instead, this tool helps you set the photo URL for each tree, then generates the exact code line you copy into shop.html. Simple â€” no coding knowledge needed.</p>
        <div class="how-it-works">
          <div class="how-step">
            <div class="how-num">1</div>
            <div class="how-text">Take a photo of your tree with your phone</div>
          </div>
          <div class="how-step">
            <div class="how-num">2</div>
            <div class="how-text">Upload it to your GitHub <code style="color:rgba(157,212,96,0.8);font-size:0.7rem;">images/</code> folder â€” or paste any web URL</div>
          </div>
          <div class="how-step">
            <div class="how-num">3</div>
            <div class="how-text">Click "Set URL" on the tree card below and enter the path</div>
          </div>
          <div class="how-step">
            <div class="how-num">4</div>
            <div class="how-text">Click "Generate Code" â€” copy and paste into shop.html</div>
          </div>
        </div>
      </div>

      <!-- Photo grid -->
      <div class="photo-grid" id="photoGrid"></div>

      <!-- Code generator -->
      <div class="code-panel" id="codePanel" style="display:none;">
        <h3>ğŸ“‹ Generated Code for shop.html</h3>
        <p>Copy everything inside the box below. Open <strong>shop.html</strong> in a text editor, find the <code>const trees = [</code> section, and replace it with this updated version. Then save and upload to GitHub.</p>
        <div class="code-block" id="generatedCode" style="max-height:300px;overflow-y:auto;"><span style="color:rgba(157,212,96,0.4);">// Click "Generate shop.html Code" above to generate</span></div>
        <button class="code-copy-btn" onclick="copyCode()">ğŸ“‹ Copy All</button>

        <div class="github-steps" style="margin-top:2rem;">
          <div style="font-family:'Playfair Display',serif;font-size:1rem;color:var(--forest);margin-bottom:1rem;">How to Apply â€” Step by Step</div>
          <div class="github-step">
            <div class="step-num">1</div>
            <div class="step-text"><strong>Upload your photos to GitHub first.</strong> Go to your repository â†’ click the <code>images</code> folder â†’ drag and drop your photos â†’ commit. Name them simply: <code>mango.jpg</code>, <code>avocado.jpg</code> etc.</div>
          </div>
          <div class="github-step">
            <div class="step-num">2</div>
            <div class="step-text"><strong>Copy the generated code</strong> from the box above using the Copy button.</div>
          </div>
          <div class="github-step">
            <div class="step-num">3</div>
            <div class="step-text"><strong>Open shop.html in GitHub.</strong> Click the pencil icon to edit. Find the line that says <code>const trees = [</code> and select everything from there down to the matching <code>];</code> â€” then paste the copied code to replace it.</div>
          </div>
          <div class="github-step">
            <div class="step-num">4</div>
            <div class="step-text"><strong>Commit the change.</strong> Scroll down, click "Commit changes". Your live shop will update within 2 minutes and show real photos.</div>
          </div>
          <div class="github-step">
            <div class="step-num">5</div>
            <div class="step-text"><strong>Check it worked.</strong> Visit your live shop, find that tree â€” if the photo shows, you're done. If not, check the image filename matches exactly (lowercase, no spaces).</div>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â• TREES PANEL â•â• -->
    <div class="panel" id="panel-trees">
      <div class="panel-header">
        <div class="panel-title">ğŸŒ³ Tree Catalogue</div>
        <button class="btn-primary" onclick="openAddModal()">+ Add New Tree</button>
      </div>
      <div class="table-toolbar">
        <div class="search-bar">
          <svg width="14" height="14" viewBox="0 0 16 16" fill="none" style="top:52%"><circle cx="6.5" cy="6.5" r="4.5" stroke="#4a7c59" stroke-width="1.5"/><path d="M10 10L14 14" stroke="#4a7c59" stroke-width="1.5" stroke-linecap="round"/></svg>
          <input type="text" placeholder="Search trees..." oninput="filterAdminTable(this.value)">
        </div>
        <select class="filter-select" onchange="filterAdminCat(this.value)">
          <option value="">All Categories</option>
          <option value="fruit">Fruit</option>
          <option value="shade">Shade</option>
          <option value="ornamental">Ornamental</option>
          <option value="native">Native</option>
          <option value="palm">Palm</option>
        </select>
        <span id="tableCount" style="font-size:0.8rem;color:var(--sage);"></span>
      </div>
      <div style="overflow-x:auto;">
        <table class="tree-table" id="adminTable">
          <thead><tr><th>Photo</th><th>Name</th><th>Latin</th><th>Category</th><th>Type</th><th>Price (UGX)</th><th>Badge</th><th>Actions</th></tr></thead>
          <tbody id="adminTableBody"></tbody>
        </table>
      </div>
    </div>

    <!-- â•â• ORDERS â•â• -->
    <div class="panel" id="panel-orders">
      <div class="panel-header">
        <div class="panel-title">ğŸ›’ Orders</div>
        <button class="btn-primary" onclick="addNewOrder()">+ Record Order</button>
      </div>
      <div id="ordersList"></div>
    </div>

    <!-- â•â• SETTINGS â•â• -->
    <div class="panel" id="panel-settings">
      <div class="panel-header"><div class="panel-title">âš™ï¸ Settings</div></div>

      <div class="settings-card">
        <h4>ğŸ“ Business Contact Numbers</h4>
        <p>The MTN and Airtel numbers that receive Mobile Money payments and WhatsApp orders.</p>
        <div class="settings-row">
          <input type="tel" id="set-mtn" value="0706191725" placeholder="MTN MoMo Number">
          <button class="save-btn" onclick="saveSetting('mtn',document.getElementById('set-mtn').value)">Save MTN</button>
        </div>
        <div class="settings-row">
          <input type="tel" id="set-airtel" value="0706191725" placeholder="Airtel Money Number">
          <button class="save-btn" onclick="saveSetting('airtel',document.getElementById('set-airtel').value)">Save Airtel</button>
        </div>
      </div>

      <div class="settings-card">
        <h4>ğŸŒ¿ Adverse AI Key</h4>
        <p>Your Anthropic API key for Adverse AI. If it stops working, replace it here and then update adverse.html manually.</p>
        <div class="settings-row">
          <input type="password" id="set-aikey" placeholder="sk-ant-api03-...">
          <button class="save-btn" onclick="saveSetting('aikey',document.getElementById('set-aikey').value)">Save Key</button>
        </div>
      </div>

      <div class="settings-card">
        <h4>ğŸ”‘ Change Admin Password</h4>
        <p>Change your login password. Default is <strong>EliteTree2024</strong> â€” please change this.</p>
        <div class="settings-row">
          <input type="password" id="set-pass1" placeholder="New Password">
          <input type="password" id="set-pass2" placeholder="Confirm Password">
          <button class="save-btn" onclick="changePassword()">Change</button>
        </div>
        <div style="background:#fff3cd;border-radius:0.6rem;padding:0.8rem 1rem;font-size:0.78rem;color:#856404;margin-top:0.8rem;">
          âš ï¸ Password is stored in your browser. Don't clear browser data or you'll need to use the default again.
        </div>
      </div>
    </div>

  </div>
</div>

<!-- â•â• ADD/EDIT TREE MODAL â•â• -->
<div class="modal-backdrop" id="treeModal">
  <div class="modal-box">
    <button class="modal-close" onclick="closeModal()">âœ•</button>
    <h3 id="modalTitle">Add New Tree Species</h3>
    <div class="tree-preview">
      <svg id="previewSVG" viewBox="0 0 160 130" style="width:120px;height:100px;"></svg>
      <p>Preview updates as you type</p>
    </div>
    <div class="form-grid">
      <div class="form-group"><label>Common Name *</label><input type="text" id="f-name" placeholder="e.g. Mango" oninput="updatePreview()"></div>
      <div class="form-group"><label>Latin Name</label><input type="text" id="f-latin" placeholder="e.g. Mangifera indica"></div>
      <div class="form-group"><label>Category *</label>
        <select id="f-cat"><option value="fruit">Fruit Tree</option><option value="shade">Shade Tree</option><option value="ornamental">Ornamental</option><option value="native">Native Species</option><option value="palm">Palm</option></select>
      </div>
      <div class="form-group"><label>Type</label>
        <select id="f-type"><option value="grafted">Grafted</option><option value="seedling">Seedling</option></select>
      </div>
      <div class="form-group"><label>Price (UGX) *</label><input type="number" id="f-price" placeholder="e.g. 18000"></div>
      <div class="form-group"><label>Badge</label>
        <select id="f-badge"><option value="">None</option><option value="popular">â­ Popular</option><option value="new">ğŸ†• New</option><option value="rare">ğŸ’ Rare</option><option value="sale">ğŸ”¥ Sale</option></select>
      </div>
      <div class="form-group full"><label>Canopy Colours</label>
        <div class="color-row">
          <input type="color" id="f-color1" value="#1a4a12" oninput="updatePreview()"><span style="font-size:0.78rem;color:var(--sage);">Main</span>
          <input type="color" id="f-color2" value="#2d7a1e" oninput="updatePreview()"><span style="font-size:0.78rem;color:var(--sage);">Secondary</span>
          <input type="color" id="f-fruit" value="#f4a128"><span style="font-size:0.78rem;color:var(--sage);">Fruit colour</span>
        </div>
      </div>
      <div class="form-group full"><label>Short Description</label><input type="text" id="f-desc" placeholder="e.g. Sweet, round, highly marketable"></div>
    </div>
    <div style="display:flex;gap:1rem;margin-top:1.5rem;">
      <button class="btn-primary" style="flex:1;" onclick="saveTree()">ğŸ’¾ Save Tree</button>
      <button onclick="closeModal()" style="padding:0.7rem 1.5rem;border:1.5px solid rgba(13,40,24,0.15);border-radius:0.6rem;background:white;cursor:pointer;font-family:'DM Sans',sans-serif;">Cancel</button>
    </div>
  </div>
</div>

<!-- â•â• URL INPUT MODAL â•â• -->
<div class="modal-backdrop" id="urlModal">
  <div class="url-modal-box">
    <button class="modal-close" onclick="closeUrlModal()">âœ•</button>
    <h3>Set Photo URL</h3>
    <p>Enter the path to your photo. If you've uploaded it to your GitHub <code>images/</code> folder, just type <code>images/filename.jpg</code>. Or paste a full web URL from Google Photos, Imgur etc.</p>
    <input type="text" id="urlInput" placeholder="images/mango.jpg  or  https://..." oninput="previewUrl(this.value)">
    <img id="urlPreviewImg" class="url-preview-img" alt="Preview">
    <div style="display:flex;gap:0.8rem;">
      <button class="btn-primary" style="flex:1;" onclick="confirmUrl()">âœ… Set This Photo</button>
      <button onclick="closeUrlModal()" style="padding:0.7rem 1.2rem;border:1.5px solid rgba(13,40,24,0.12);border-radius:0.6rem;background:white;cursor:pointer;font-family:'DM Sans',sans-serif;">Cancel</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEFAULT_PASS = 'EliteTree2024';
function doLogin(){
  const pass = document.getElementById('loginPass').value;
  const stored = localStorage.getItem('ets_admin_pass') || DEFAULT_PASS;
  if(pass === stored){
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('adminScreen').style.display='block';
    initAdmin();
  } else {
    document.getElementById('loginError').style.display='block';
    document.getElementById('loginPass').value='';
  }
}
function logout(){
  document.getElementById('loginScreen').style.display='flex';
  document.getElementById('adminScreen').style.display='none';
}
function changePassword(){
  const p1=document.getElementById('set-pass1').value;
  const p2=document.getElementById('set-pass2').value;
  if(!p1||p1.length<6){showToast('Password must be at least 6 characters.');return;}
  if(p1!==p2){showToast('Passwords do not match!');return;}
  localStorage.setItem('ets_admin_pass',p1);
  document.getElementById('set-pass1').value='';
  document.getElementById('set-pass2').value='';
  showToast('âœ… Password changed!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PANELS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showPanel(name, btn){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.admin-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('panel-'+name).classList.add('active');
  if(btn) btn.classList.add('active');
  if(name==='trees') renderAdminTable(getAllTrees());
  if(name==='photos') renderPhotoGrid();
  if(name==='orders') renderOrders();
  if(name==='dashboard') updateStats();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TREE DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MASTER_TREES = [
  {id:'t1',name:'Apple Mango',latin:'Mangifera indica',cat:'fruit',type:'grafted',price:18000,badge:'popular',color1:'#1a4a12',color2:'#2d7a1e',fruit:'#f4a128',desc:'Sweet, round, highly marketable'},
  {id:'t2',name:'Kent Mango',latin:'Mangifera indica',cat:'fruit',type:'grafted',price:22000,badge:'new',color1:'#1a5a12',color2:'#3a8a24',fruit:'#e8902a',desc:'Late-season, ideal for export'},
  {id:'t3',name:'Haden Mango',latin:'Mangifera indica',cat:'fruit',type:'grafted',price:15000,badge:'',color1:'#2d6a18',color2:'#4a9a2e',fruit:'#ffb347',desc:'Reliable, disease-resistant'},
  {id:'t4',name:'Hass Avocado',latin:'Persea americana',cat:'fruit',type:'grafted',price:25000,badge:'popular',color1:'#1a5c12',color2:'#2d7a18',fruit:'#2d4a1a',desc:'Global gold standard variety'},
  {id:'t5',name:'Fuerte Avocado',latin:'Persea americana',cat:'fruit',type:'grafted',price:20000,badge:'',color1:'#2a6a18',color2:'#3a7a24',fruit:'#3a5a20',desc:'Mid-altitude workhorse variety'},
  {id:'t6',name:'Washington Navel Orange',latin:'Citrus sinensis',cat:'fruit',type:'grafted',price:18000,badge:'',color1:'#2d5a10',color2:'#3a7a18',fruit:'#ff8c00',desc:'Seedless, sweet eating orange'},
  {id:'t7',name:'Eureka Lemon',latin:'Citrus limon',cat:'fruit',type:'grafted',price:16000,badge:'',color1:'#3a6a18',color2:'#4a8a24',fruit:'#ffd700',desc:'Year-round fruiting lemon'},
  {id:'t8',name:'Jackfruit',latin:'Artocarpus heterophyllus',cat:'fruit',type:'grafted',price:20000,badge:'popular',color1:'#2a5a10',color2:'#3a7a1a',fruit:'#8b8000',desc:"Uganda's giant sweet fruit tree"},
  {id:'t9',name:'Guava',latin:'Psidium guajava',cat:'fruit',type:'grafted',price:12000,badge:'',color1:'#3a7a18',color2:'#4a9a24',fruit:'#ffd700',desc:'Fast-bearing, nutritious fruit'},
  {id:'t10',name:'Passion Fruit',latin:'Passiflora edulis',cat:'fruit',type:'grafted',price:10000,badge:'new',color1:'#4a3a78',color2:'#6a5a98',fruit:'#9b59b6',desc:'Climbing vine, commercial value'},
  {id:'t11',name:'Pawpaw / Papaya',latin:'Carica papaya',cat:'fruit',type:'seedling',price:6000,badge:'sale',price_old:9000,color1:'#2d6a10',color2:'#3a8a1a',fruit:'#ff8c00',desc:'Fast-growing tropical fruit'},
  {id:'t12',name:'Tamarind',latin:'Tamarindus indica',cat:'fruit',type:'grafted',price:22000,badge:'',color1:'#4a5a1a',color2:'#6a7a2a',fruit:'#8b4513',desc:'Long-lived specimen, sweet pods'},
  {id:'t13',name:'Banana â€” Matooke',latin:'Musa acuminata',cat:'fruit',type:'seedling',price:8000,badge:'popular',color1:'#2d7a18',color2:'#4a9a28',fruit:'#ffd700',desc:"Uganda's staple food plant"},
  {id:'t14',name:'Coconut Palm',latin:'Cocos nucifera',cat:'fruit',type:'seedling',price:15000,badge:'',color1:'#1a4a2e',color2:'#2d6a40',fruit:'#8b6914',desc:'Tropical icon, high value nuts'},
  {id:'t15',name:'Natal Fig',latin:'Ficus natalensis',cat:'shade',type:'seedling',price:18000,badge:'popular',color1:'#1a4a12',color2:'#2d6a20',fruit:'',desc:"Uganda's beloved community tree"},
  {id:'t16',name:'African Mahogany',latin:'Khaya senegalensis',cat:'shade',type:'seedling',price:25000,badge:'',color1:'#1a3a10',color2:'#2a5a18',fruit:'',desc:'Stately, long-lived hardwood'},
  {id:'t17',name:'Neem Tree',latin:'Azadirachta indica',cat:'shade',type:'seedling',price:10000,badge:'',color1:'#2d5a18',color2:'#3a7a24',fruit:'',desc:'Fast-growing, medicinal qualities'},
  {id:'t18',name:'Moringa',latin:'Moringa oleifera',cat:'shade',type:'seedling',price:8000,badge:'new',color1:'#3a6a20',color2:'#4a8a2e',fruit:'',desc:'Nutritional superfood tree'},
  {id:'t19',name:'Umbrella Thorn Acacia',latin:'Vachellia tortilis',cat:'shade',type:'seedling',price:15000,badge:'',color1:'#4a5a18',color2:'#6a7a28',fruit:'',desc:'Iconic African flat-topped silhouette'},
  {id:'t20',name:'Cape Chestnut',latin:'Calodendrum capense',cat:'shade',type:'seedling',price:22000,badge:'',color1:'#2a3a50',color2:'#3a5a70',fruit:'',desc:'Stunning pink flowering canopy'},
  {id:'t21',name:'Musizi / White Stinkwood',latin:'Cordia millenii',cat:'shade',type:'seedling',price:20000,badge:'popular',color1:'#1a4a18',color2:'#2d6a28',fruit:'',desc:'Native Uganda premium timber shade'},
  {id:'t22',name:'East African Yellowwood',latin:'Podocarpus latifolius',cat:'shade',type:'seedling',price:28000,badge:'rare',color1:'#1a3a20',color2:'#2d5a30',fruit:'',desc:'Slow-growing, extremely long-lived'},
  {id:'t23',name:'Jacaranda',latin:'Jacaranda mimosifolia',cat:'ornamental',type:'seedling',price:20000,badge:'popular',color1:'#3a1a7a',color2:'#5a2a9a',fruit:'',desc:'Purple flowering spectacle'},
  {id:'t24',name:'Flamboyant / Flame Tree',latin:'Delonix regia',cat:'ornamental',type:'seedling',price:18000,badge:'popular',color1:'#7a2010',color2:'#a03020',fruit:'',desc:'Blazing red seasonal display'},
  {id:'t25',name:'Frangipani',latin:'Plumeria rubra',cat:'ornamental',type:'seedling',price:22000,badge:'',color1:'#3a1a3a',color2:'#6a3a5a',fruit:'',desc:'Heavenly scented tropical flower'},
  {id:'t26',name:'African Tulip',latin:'Spathodea campanulata',cat:'ornamental',type:'seedling',price:16000,badge:'new',color1:'#6a1a10',color2:'#8a2a18',fruit:'',desc:'Uganda native, vivid orange blooms'},
  {id:'t27',name:'Bougainvillea',latin:'Bougainvillea spectabilis',cat:'ornamental',type:'seedling',price:12000,badge:'',color1:'#7a1a5a',color2:'#9a3a7a',fruit:'',desc:'Blazing colour all year round'},
  {id:'t28',name:'Pride of India',latin:'Lagerstroemia speciosa',cat:'ornamental',type:'seedling',price:24000,badge:'rare',color1:'#4a1a6a',color2:'#6a3a8a',fruit:'',desc:'Magnificent purple flowering tree'},
  {id:'t29',name:'Yellow Cassia',latin:'Cassia fistula',cat:'ornamental',type:'seedling',price:16000,badge:'',color1:'#4a5a10',color2:'#6a7a20',fruit:'',desc:'Cascading golden flowers in season'},
  {id:'t30',name:'Bottle Brush',latin:'Callistemon citrinus',cat:'ornamental',type:'seedling',price:14000,badge:'',color1:'#5a1a10',color2:'#7a2a18',fruit:'',desc:'Unique red brush-like flowers'},
  {id:'t31',name:'Weeping Fig',latin:'Ficus benjamina',cat:'ornamental',type:'seedling',price:18000,badge:'popular',color1:'#1a4a18',color2:'#2d6a28',fruit:'',desc:'Classic elegant avenue tree'},
  {id:'t32',name:'Mvule / African Teak',latin:'Milicia excelsa',cat:'native',type:'seedling',price:30000,badge:'rare',color1:'#1a3a10',color2:'#2a5a18',fruit:'',desc:"Uganda's most prized native timber"},
  {id:'t33',name:'Elgon Olive',latin:'Olea europaea subsp. africana',cat:'native',type:'seedling',price:28000,badge:'rare',color1:'#3a4a18',color2:'#5a6a28',fruit:'',desc:'Native Ugandan olive, long-lived'},
  {id:'t34',name:'Prunus africana',latin:'Prunus africana',cat:'native',type:'seedling',price:32000,badge:'rare',color1:'#2a3a18',color2:'#3a5a28',fruit:'',desc:'Medicinal bark, conservation species'},
  {id:'t35',name:'Strangler Fig',latin:'Ficus thonningii',cat:'native',type:'seedling',price:18000,badge:'',color1:'#1a4a10',color2:'#2d6a18',fruit:'',desc:'Sacred Ugandan village tree'},
  {id:'t36',name:'Warburgia',latin:'Warburgia ugandensis',cat:'native',type:'seedling',price:35000,badge:'rare',color1:'#1a3a18',color2:'#2a5a28',fruit:'',desc:'Uganda endemic, highly medicinal'},
  {id:'t37',name:'Markhamia',latin:'Markhamia lutea',cat:'native',type:'seedling',price:14000,badge:'popular',color1:'#2a5a10',color2:'#3a7a1a',fruit:'',desc:'Fast-growing native shade tree'},
  {id:'t38',name:'Albizia',latin:'Albizia coriaria',cat:'native',type:'seedling',price:16000,badge:'',color1:'#3a5a18',color2:'#4a7a28',fruit:'',desc:'Nitrogen-fixing, soil improving'},
  {id:'t39',name:'Royal Palm',latin:'Roystonea regia',cat:'palm',type:'seedling',price:45000,badge:'popular',color1:'#1a4a2e',color2:'#2d6a44',fruit:'',desc:'Majestic formal avenue palm'},
  {id:'t40',name:'Date Palm',latin:'Phoenix dactylifera',cat:'palm',type:'seedling',price:38000,badge:'',color1:'#2a4a20',color2:'#3a6a30',fruit:'#8b6914',desc:'Productive date-bearing palm'},
  {id:'t41',name:'Fan Palm',latin:'Livistona chinensis',cat:'palm',type:'seedling',price:30000,badge:'new',color1:'#1a5a2e',color2:'#2d7a44',fruit:'',desc:'Dramatic spreading fan-shaped fronds'},
  {id:'t42',name:'Bamboo Palm',latin:'Chamaedorea seifrizii',cat:'palm',type:'seedling',price:25000,badge:'',color1:'#2d5a28',color2:'#3a7a38',fruit:'',desc:'Elegant multi-stem indoor/outdoor palm'},
];

function getAllTrees(){
  const saved = localStorage.getItem('ets_trees');
  return saved ? JSON.parse(saved) : MASTER_TREES;
}
function saveTrees(arr){
  localStorage.setItem('ets_trees', JSON.stringify(arr));
  updateStats();
}

// Photo storage â€” separate from tree data
function getPhotos(){
  return JSON.parse(localStorage.getItem('ets_photos')||'{}');
}
function savePhoto(treeId, url){
  const photos = getPhotos();
  if(url) photos[treeId] = url;
  else delete photos[treeId];
  localStorage.setItem('ets_photos', JSON.stringify(photos));
  updateStats();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PHOTO MANAGER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPhotoGrid(){
  const trees = getAllTrees();
  const photos = getPhotos();
  const grid = document.getElementById('photoGrid');
  grid.innerHTML = trees.map(t => {
    const hasPhoto = !!photos[t.id];
    const imgUrl = photos[t.id] || '';
    return `
    <div class="photo-card">
      <div class="photo-card-thumb ${hasPhoto?'has-photo':'no-photo'}" onclick="${!hasPhoto?`openUrlModal('${t.id}')`:''}" title="${!hasPhoto?'Click to add photo':''}">
        ${hasPhoto
          ? `<img src="${imgUrl}" alt="${t.name}" onerror="this.style.display='none';this.nextSibling.style.display='flex'">`
          : ''
        }
        <div class="photo-placeholder-icon" ${hasPhoto?'style="display:none"':''}> 
          <div>ğŸ“·</div>
          <p>No photo yet<br>Click to add</p>
        </div>
      </div>
      <div class="photo-card-body">
        <div class="photo-card-name">${t.name}</div>
        <div class="photo-card-cat">${t.cat} Â· ${t.type} Â· UGX ${t.price.toLocaleString()}</div>
        <div class="photo-card-actions">
          <button class="photo-upload-btn" onclick="openUrlModal('${t.id}')">
            ${hasPhoto ? 'ğŸ”„ Change Photo' : 'ğŸ“ Set URL'}
          </button>
          ${hasPhoto ? `<button class="photo-clear-btn" onclick="clearPhoto('${t.id}')">âœ•</button>` : ''}
        </div>
        ${imgUrl ? `<div style="font-size:0.62rem;color:var(--sage);margin-top:0.4rem;word-break:break-all;opacity:0.7;">${imgUrl}</div>` : ''}
      </div>
    </div>`;
  }).join('');
}

function clearPhoto(treeId){
  if(!confirm('Remove photo for this tree?')) return;
  savePhoto(treeId, null);
  renderPhotoGrid();
  updateStats();
  showToast('ğŸ“· Photo removed.');
}

// â”€â”€ URL MODAL â”€â”€
let currentUrlTreeId = null;
function openUrlModal(treeId){
  currentUrlTreeId = treeId;
  const photos = getPhotos();
  document.getElementById('urlInput').value = photos[treeId] || '';
  document.getElementById('urlPreviewImg').style.display = 'none';
  document.getElementById('urlModal').classList.add('open');
  setTimeout(()=>document.getElementById('urlInput').focus(), 100);
}
function closeUrlModal(){
  document.getElementById('urlModal').classList.remove('open');
  currentUrlTreeId = null;
}
function previewUrl(val){
  const img = document.getElementById('urlPreviewImg');
  if(val && (val.startsWith('http')||val.startsWith('images/'))){
    img.src = val;
    img.style.display = 'block';
  } else {
    img.style.display = 'none';
  }
}
function confirmUrl(){
  const url = document.getElementById('urlInput').value.trim();
  if(!url){showToast('Please enter a URL or file path.');return;}
  savePhoto(currentUrlTreeId, url);
  closeUrlModal();
  renderPhotoGrid();
  updateStats();
  showToast('âœ… Photo URL saved!');
}

// â”€â”€ CODE GENERATOR â”€â”€
function generateAllCode(){
  const trees = getAllTrees();
  const photos = getPhotos();
  let count = 0;

  const lines = trees.map(t => {
    const photo = photos[t.id];
    if(photo) count++;
    const img = photo ? `,\n    img:'${photo}'` : '';
    const priceOld = t.price_old ? `,price_old:${t.price_old}` : '';
    return `  {id:'${t.id}',name:'${t.name}',latin:'${t.latin||''}',cat:'${t.cat}',type:'${t.type}',price:${t.price}${priceOld},badge:'${t.badge||''}',color1:'${t.color1||'#1a4a12'}',color2:'${t.color2||'#2d7a1e'}',fruit:'${t.fruit||''}',desc:'${(t.desc||'').replace(/'/g,"\\'")}'\${img}}`;
  }).join(',\n');

  const code = `const trees = [\n${lines}\n];`;
  document.getElementById('generatedCode').textContent = code;
  document.getElementById('codePanel').style.display = 'block';
  document.getElementById('codePanel').scrollIntoView({behavior:'smooth'});
  showToast(`âœ… Code generated! ${count} tree${count!==1?'s':''} have photos.`);
}

function copyCode(){
  const code = document.getElementById('generatedCode').textContent;
  navigator.clipboard.writeText(code).then(()=>{
    showToast('âœ… Code copied to clipboard!');
  }).catch(()=>{
    // Fallback
    const ta = document.createElement('textarea');
    ta.value = code;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    showToast('âœ… Code copied!');
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ADMIN TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAdminTable(list){
  const photos = getPhotos();
  const body = document.getElementById('adminTableBody');
  document.getElementById('tableCount').textContent = `${list.length} species`;
  if(!list.length){
    body.innerHTML=`<tr><td colspan="8" style="text-align:center;padding:2rem;color:var(--sage);">No trees found.</td></tr>`;
    return;
  }
  body.innerHTML = list.map(t=>`
    <tr>
      <td>
        <div class="tree-thumb-mini">
          ${photos[t.id]
            ? `<img src="${photos[t.id]}" alt="${t.name}" onerror="this.style.display='none'">`
            : miniSVG(t)
          }
        </div>
      </td>
      <td><strong>${t.name}</strong></td>
      <td style="font-style:italic;color:var(--sage);font-size:0.78rem;">${t.latin||'â€”'}</td>
      <td><span class="cat-badge cat-${t.cat}">${t.cat}</span></td>
      <td style="color:var(--sage);">${t.type}</td>
      <td class="price-cell">UGX ${Number(t.price).toLocaleString()}</td>
      <td>${t.badge?`<span style="font-size:0.75rem;">${t.badge==='popular'?'â­':t.badge==='new'?'ğŸ†•':t.badge==='rare'?'ğŸ’':'ğŸ”¥'} ${t.badge}</span>`:'â€”'}</td>
      <td>
        <div class="action-btns">
          <button class="btn-edit" onclick="editTree('${t.id}')">âœï¸ Edit</button>
          <button class="btn-danger" onclick="deleteTree('${t.id}')">ğŸ—‘</button>
        </div>
      </td>
    </tr>`).join('');
}
function miniSVG(t){
  const c1=t.color1||'#1a4a12',c2=t.color2||'#2d6a20';
  return `<svg viewBox="0 0 40 40" fill="none"><rect width="40" height="40" fill="${c1}"/><ellipse cx="20" cy="18" rx="14" ry="12" fill="${c2}"/><ellipse cx="20" cy="12" rx="10" ry="9" fill="${c1}"/><path d="M17 38 C16 30 16 24 18 18 L22 18 C24 24 24 30 23 38Z" fill="#5c3a14"/></svg>`;
}
function filterAdminTable(q){
  renderAdminTable(getAllTrees().filter(t=>t.name.toLowerCase().includes(q.toLowerCase())||(t.latin||'').toLowerCase().includes(q.toLowerCase())));
}
function filterAdminCat(cat){
  renderAdminTable(cat ? getAllTrees().filter(t=>t.cat===cat) : getAllTrees());
}

// â”€â”€ ADD / EDIT â”€â”€
let editingId = null;
function openAddModal(){
  editingId=null;
  document.getElementById('modalTitle').textContent='Add New Tree Species';
  ['f-name','f-latin','f-price','f-desc'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('f-cat').value='fruit';
  document.getElementById('f-type').value='grafted';
  document.getElementById('f-badge').value='';
  document.getElementById('f-color1').value='#1a4a12';
  document.getElementById('f-color2').value='#2d7a1e';
  document.getElementById('f-fruit').value='#f4a128';
  updatePreview();
  document.getElementById('treeModal').classList.add('open');
}
function editTree(id){
  const t = getAllTrees().find(x=>x.id===id);
  if(!t) return;
  editingId=id;
  document.getElementById('modalTitle').textContent='Edit: '+t.name;
  document.getElementById('f-name').value=t.name;
  document.getElementById('f-latin').value=t.latin||'';
  document.getElementById('f-cat').value=t.cat;
  document.getElementById('f-type').value=t.type;
  document.getElementById('f-price').value=t.price;
  document.getElementById('f-badge').value=t.badge||'';
  document.getElementById('f-color1').value=t.color1||'#1a4a12';
  document.getElementById('f-color2').value=t.color2||'#2d7a1e';
  document.getElementById('f-fruit').value=t.fruit||'#f4a128';
  document.getElementById('f-desc').value=t.desc||'';
  updatePreview();
  document.getElementById('treeModal').classList.add('open');
}
function saveTree(){
  const name=document.getElementById('f-name').value.trim();
  const price=parseInt(document.getElementById('f-price').value);
  if(!name){showToast('Please enter a tree name.');return;}
  if(!price||price<1){showToast('Please enter a valid price.');return;}
  const treeData={
    id:editingId||'custom_'+Date.now(),
    name,latin:document.getElementById('f-latin').value.trim(),
    cat:document.getElementById('f-cat').value,
    type:document.getElementById('f-type').value,
    price,badge:document.getElementById('f-badge').value,
    color1:document.getElementById('f-color1').value,
    color2:document.getElementById('f-color2').value,
    fruit:document.getElementById('f-fruit').value,
    desc:document.getElementById('f-desc').value.trim(),
  };
  let trees=getAllTrees();
  if(editingId){trees=trees.map(t=>t.id===editingId?treeData:t);showToast('âœ… Tree updated!');}
  else{trees.push(treeData);showToast('âœ… Tree added!');}
  saveTrees(trees);
  renderAdminTable(trees);
  closeModal();
}
function deleteTree(id){
  if(!confirm('Delete this tree? Cannot be undone.')) return;
  saveTrees(getAllTrees().filter(t=>t.id!==id));
  renderAdminTable(getAllTrees());
  showToast('ğŸ—‘ Tree deleted.');
}
function closeModal(){
  document.getElementById('treeModal').classList.remove('open');
  editingId=null;
}
function updatePreview(){
  const c1=document.getElementById('f-color1').value;
  const c2=document.getElementById('f-color2').value;
  const fruit=document.getElementById('f-fruit').value;
  document.getElementById('previewSVG').innerHTML=`
    <rect width="160" height="130" fill="${c1}"/>
    <ellipse cx="80" cy="90" rx="55" ry="15" fill="rgba(0,0,0,0.2)"/>
    <path d="M74 125 C72 100 70 85 72 72 C74 60 80 54 80 54 C80 54 86 60 88 72 C90 85 88 100 86 125Z" fill="#5c3a14"/>
    <ellipse cx="80" cy="68" rx="45" ry="36" fill="${c1}"/>
    <ellipse cx="56" cy="64" rx="30" ry="26" fill="${c2}"/>
    <ellipse cx="104" cy="62" rx="28" ry="24" fill="${c1}"/>
    <ellipse cx="80" cy="50" rx="36" ry="30" fill="${c2}"/>
    <ellipse cx="80" cy="35" rx="26" ry="22" fill="${c1}"/>
    <ellipse cx="80" cy="22" rx="17" ry="16" fill="${c2}"/>
    ${fruit?`<ellipse cx="64" cy="72" rx="7" ry="9" fill="${fruit}" opacity="0.9"/>
    <ellipse cx="96" cy="70" rx="6" ry="8" fill="${fruit}" opacity="0.9"/>
    <ellipse cx="80" cy="82" rx="8" ry="10" fill="${fruit}"/>`:''}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ORDERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderOrders(){
  const orders=JSON.parse(localStorage.getItem('ets_orders')||'[]');
  const list=document.getElementById('ordersList');
  if(!orders.length){
    list.innerHTML=`<div style="background:white;border-radius:1rem;padding:2.5rem;text-align:center;color:var(--sage);border:1px solid rgba(13,40,24,0.07);">
      <div style="font-size:2.5rem;margin-bottom:0.8rem;">ğŸ“­</div>
      <p style="margin-bottom:1.2rem;">No orders yet. When customers order via WhatsApp, record them here.</p>
      <button class="btn-primary" onclick="addNewOrder()">+ Record First Order</button>
    </div>`;
    return;
  }
  list.innerHTML=orders.map((o,i)=>`
    <div class="order-card ${o.status}">
      <div class="order-header">
        <div class="order-id">#ETS-${String(i+1).padStart(3,'0')} Â· ${o.name}</div>
        <span class="order-status status-${o.status}">${o.status==='completed'?'âœ… Completed':'â³ Pending'}</span>
      </div>
      <div style="font-size:0.82rem;color:var(--sage);line-height:1.8;">
        ğŸ“ ${o.phone||'â€”'} Â· ğŸ“ ${o.location||'â€”'} Â· ğŸ’³ ${o.payment||'WhatsApp'}<br>
        ğŸ›’ ${o.items||'â€”'} Â· ğŸ“… ${o.date||'â€”'}
      </div>
      <div style="font-family:'Playfair Display',serif;font-size:1rem;font-weight:700;color:var(--forest);margin-top:0.6rem;">UGX ${Number(o.total||0).toLocaleString()}</div>
      <div style="display:flex;gap:0.7rem;margin-top:0.8rem;">
        ${o.status!=='completed'?`<button class="btn-edit" onclick="markComplete(${i})">âœ… Mark Complete</button>`:''}
        <button class="btn-danger" onclick="deleteOrder(${i})">ğŸ—‘ Delete</button>
      </div>
    </div>`).join('');
}
function addNewOrder(){
  const name=prompt('Customer Name:'); if(!name) return;
  const phone=prompt('Phone Number:')||'';
  const items=prompt('Items ordered (e.g. 5Ã— Apple Mango, 2Ã— Hass Avocado):')||'';
  const total=prompt('Total amount (UGX):')||0;
  const payment=prompt('Payment method (MTN / Airtel / International / WhatsApp):')||'WhatsApp';
  const location=prompt('Customer district/location:')||'';
  const orders=JSON.parse(localStorage.getItem('ets_orders')||'[]');
  orders.push({name,phone,items,total,payment,location,status:'pending',date:new Date().toLocaleDateString('en-UG')});
  localStorage.setItem('ets_orders',JSON.stringify(orders));
  renderOrders();
  updateStats();
  showToast('âœ… Order recorded!');
}
function markComplete(i){
  const orders=JSON.parse(localStorage.getItem('ets_orders')||'[]');
  if(orders[i]) orders[i].status='completed';
  localStorage.setItem('ets_orders',JSON.stringify(orders));
  renderOrders();
  showToast('âœ… Order marked complete!');
}
function deleteOrder(i){
  if(!confirm('Delete this order record?')) return;
  const orders=JSON.parse(localStorage.getItem('ets_orders')||'[]');
  orders.splice(i,1);
  localStorage.setItem('ets_orders',JSON.stringify(orders));
  renderOrders();
  showToast('ğŸ—‘ Deleted.');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveSetting(key,val){
  if(!val){showToast('Please enter a value.');return;}
  localStorage.setItem('ets_'+key,val);
  showToast('âœ… Saved!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateStats(){
  document.getElementById('stat-trees').textContent=getAllTrees().length;
  document.getElementById('stat-photos').textContent=Object.keys(getPhotos()).length;
  document.getElementById('stat-orders').textContent=JSON.parse(localStorage.getItem('ets_orders')||'[]').length;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initAdmin(){
  updateStats();
  updatePreview();
  renderAdminTable(getAllTrees());
}

// Close modals on backdrop click
document.getElementById('treeModal').addEventListener('click',e=>{if(e.target===document.getElementById('treeModal'))closeModal();});
document.getElementById('urlModal').addEventListener('click',e=>{if(e.target===document.getElementById('urlModal'))closeUrlModal();});
document.getElementById('loginPass').addEventListener('keydown',e=>{if(e.key==='Enter')doLogin();});
</script>
  <script src="pwa.js" defer></script>
</body>
</html>
