<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adverse AI ‚Äî Elite Tree Solutions Agriculture Advisor</title>
<meta name="description" content="Ask Adverse AI anything about trees, planting, pests and agriculture in Uganda. Powered by Elite Tree Solutions.">
<meta name="robots" content="noindex">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400&family=IBM+Plex+Mono:wght@300;400;500&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
/* ‚îÄ‚îÄ ROOT ‚îÄ‚îÄ */
:root{
  --void:#060e08;
  --deep:#0a1a0c;
  --forest:#0d2818;
  --moss:#1a4a2e;
  --sage:#4a7c59;
  --leaf:#7ab648;
  --bright:#9dd460;
  --gold:#c8a96e;
  --cream:#f5f0e8;
  --mist:rgba(122,182,72,0.06);
  --line:rgba(122,182,72,0.12);
  --glow:rgba(122,182,72,0.15);
}

*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}

body{
  font-family:'DM Sans',sans-serif;
  background:var(--void);
  color:var(--cream);
  display:flex;
  flex-direction:column;
  position:relative;
}

/* ‚îÄ‚îÄ GRAIN OVERLAY ‚îÄ‚îÄ */
body::before{
  content:'';
  position:fixed;inset:0;z-index:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events:none;opacity:0.6;
}

/* ‚îÄ‚îÄ AMBIENT GLOW ‚îÄ‚îÄ */
.ambient{
  position:fixed;pointer-events:none;z-index:0;
  border-radius:50%;filter:blur(120px);
  transition:all 2s ease;
}
.amb-1{width:600px;height:600px;background:radial-gradient(circle,rgba(122,182,72,0.06),transparent);top:-200px;left:-200px;}
.amb-2{width:500px;height:500px;background:radial-gradient(circle,rgba(200,169,110,0.04),transparent);bottom:-150px;right:-150px;}

/* ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ */
.topbar{
  position:relative;z-index:10;
  display:flex;align-items:center;justify-content:space-between;
  padding:1rem 1.8rem;
  border-bottom:1px solid var(--line);
  background:rgba(6,14,8,0.8);
  backdrop-filter:blur(20px);
  flex-shrink:0;
}

.brand{display:flex;align-items:center;gap:0.9rem;}
.brand-icon{
  width:36px;height:36px;border-radius:8px;
  background:linear-gradient(135deg,var(--moss),var(--forest));
  border:1px solid var(--line);
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;
}
.brand-name{font-family:'Playfair Display',serif;font-size:1.05rem;font-weight:700;color:var(--cream);}
.brand-sub{font-size:0.65rem;color:var(--sage);letter-spacing:0.12em;text-transform:uppercase;margin-top:0.05rem;}

.status{display:flex;align-items:center;gap:0.5rem;font-size:0.72rem;color:var(--sage);}
.status-dot{width:7px;height:7px;border-radius:50%;background:var(--leaf);animation:pulse 2.5s ease infinite;}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(122,182,72,0.4);}50%{opacity:0.8;box-shadow:0 0 0 5px rgba(122,182,72,0);}}

.topbar-actions{display:flex;align-items:center;gap:0.8rem;}
.btn-ghost{
  background:none;border:1px solid var(--line);color:var(--sage);
  padding:0.4rem 0.9rem;border-radius:0.5rem;font-size:0.75rem;
  cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s;
  display:flex;align-items:center;gap:0.4rem;
}
.btn-ghost:hover{border-color:var(--leaf);color:var(--leaf);}
.btn-home{
  background:var(--mist);border:1px solid var(--line);color:var(--leaf);
  padding:0.4rem 1rem;border-radius:0.5rem;font-size:0.75rem;
  cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s;text-decoration:none;
  display:flex;align-items:center;gap:0.4rem;
}
.btn-home:hover{background:rgba(122,182,72,0.12);}

/* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
.main{display:flex;flex:1;overflow:hidden;position:relative;z-index:1;}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
.sidebar{
  width:260px;flex-shrink:0;
  border-right:1px solid var(--line);
  background:rgba(6,14,8,0.6);
  display:flex;flex-direction:column;
  overflow:hidden;
}

.sidebar-section{padding:1.2rem 1.2rem 0.8rem;}
.sidebar-label{
  font-size:0.6rem;text-transform:uppercase;letter-spacing:0.16em;
  color:rgba(122,182,72,0.4);margin-bottom:0.8rem;
  font-family:'IBM Plex Mono',monospace;
}

/* Suggested questions */
.sq-list{display:flex;flex-direction:column;gap:0.4rem;}
.sq-item{
  padding:0.65rem 0.85rem;
  border:1px solid var(--line);border-radius:0.6rem;
  font-size:0.75rem;color:rgba(245,240,232,0.6);
  cursor:pointer;transition:all 0.2s;
  background:rgba(122,182,72,0.02);
  line-height:1.4;
}
.sq-item:hover{border-color:rgba(122,182,72,0.3);color:var(--cream);background:var(--mist);}
.sq-item::before{content:'‚Üí ';color:var(--leaf);opacity:0.6;}

/* Capabilities */
.cap-list{display:flex;flex-direction:column;gap:0.5rem;padding:0 1.2rem 1.2rem;}
.cap-item{display:flex;align-items:center;gap:0.6rem;font-size:0.73rem;color:var(--sage);}
.cap-dot{width:5px;height:5px;border-radius:50%;background:var(--leaf);flex-shrink:0;opacity:0.7;}

/* Tree quick ref */
.tree-ref{
  border-top:1px solid var(--line);
  padding:1rem 1.2rem;
  flex:1;overflow-y:auto;
}
.tree-ref::-webkit-scrollbar{width:3px;}
.tree-ref::-webkit-scrollbar-track{background:transparent;}
.tree-ref::-webkit-scrollbar-thumb{background:rgba(122,182,72,0.2);border-radius:2px;}
.tree-pill{
  display:inline-block;margin:0.2rem 0.2rem 0;
  padding:0.2rem 0.6rem;border-radius:1rem;
  font-size:0.65rem;color:var(--sage);
  border:1px solid var(--line);background:transparent;
  cursor:pointer;transition:all 0.2s;font-family:'DM Sans',sans-serif;
}
.tree-pill:hover{border-color:var(--leaf);color:var(--leaf);}

/* ‚îÄ‚îÄ CHAT AREA ‚îÄ‚îÄ */
.chat-wrap{flex:1;display:flex;flex-direction:column;overflow:hidden;}

/* Messages */
.messages{
  flex:1;overflow-y:auto;
  padding:2rem 2rem 1rem;
  display:flex;flex-direction:column;gap:1.5rem;
  scroll-behavior:smooth;
}
.messages::-webkit-scrollbar{width:4px;}
.messages::-webkit-scrollbar-track{background:transparent;}
.messages::-webkit-scrollbar-thumb{background:rgba(122,182,72,0.15);border-radius:2px;}

/* Welcome screen */
.welcome{
  display:flex;flex-direction:column;align-items:center;
  justify-content:center;flex:1;text-align:center;
  padding:3rem 2rem;
  animation:fadeUp 0.8s ease forwards;
}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:none;}}

.welcome-icon{
  width:80px;height:80px;border-radius:20px;
  background:linear-gradient(135deg,var(--moss),var(--deep));
  border:1px solid var(--line);
  display:flex;align-items:center;justify-content:center;
  margin:0 auto 1.5rem;
  box-shadow:0 0 40px rgba(122,182,72,0.1);
}
.welcome h1{
  font-family:'Playfair Display',serif;
  font-size:clamp(1.6rem,3vw,2.2rem);font-weight:900;
  color:var(--cream);margin-bottom:0.5rem;line-height:1.2;
}
.welcome h1 em{color:var(--leaf);font-style:italic;}
.welcome p{font-size:0.88rem;color:var(--sage);max-width:420px;line-height:1.7;margin-bottom:2rem;}
.welcome-chips{display:flex;flex-wrap:wrap;gap:0.5rem;justify-content:center;max-width:500px;}
.chip{
  padding:0.5rem 1rem;border:1px solid var(--line);border-radius:2rem;
  font-size:0.76rem;color:rgba(245,240,232,0.6);cursor:pointer;
  transition:all 0.2s;background:var(--mist);
}
.chip:hover{border-color:var(--leaf);color:var(--cream);}

/* Message bubbles */
.msg{display:flex;gap:0.9rem;animation:msgIn 0.35s ease forwards;}
@keyframes msgIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:none;}}

.msg.user{flex-direction:row-reverse;}
.msg-avatar{
  width:32px;height:32px;border-radius:8px;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;font-size:0.85rem;
  font-weight:700;font-family:'Playfair Display',serif;margin-top:2px;
}
.msg-avatar.ai{
  background:linear-gradient(135deg,var(--moss),var(--deep));
  border:1px solid var(--line);color:var(--leaf);font-size:0.7rem;
}
.msg-avatar.user{background:rgba(122,182,72,0.12);border:1px solid var(--line);color:var(--sage);}

.msg-body{max-width:72%;display:flex;flex-direction:column;gap:0.3rem;}
.msg.user .msg-body{align-items:flex-end;}

.bubble{
  padding:0.9rem 1.1rem;border-radius:1rem;
  font-size:0.85rem;line-height:1.75;
  position:relative;
}
.bubble.ai{
  background:rgba(10,26,12,0.8);
  border:1px solid var(--line);
  border-radius:1rem 1rem 1rem 0.2rem;
  color:rgba(245,240,232,0.88);
}
.bubble.user{
  background:rgba(122,182,72,0.1);
  border:1px solid rgba(122,182,72,0.2);
  border-radius:1rem 1rem 0.2rem 1rem;
  color:var(--cream);
}
.bubble.ai h3{font-family:'Playfair Display',serif;font-size:0.95rem;color:var(--cream);margin:0.7rem 0 0.3rem;}
.bubble.ai h3:first-child{margin-top:0;}
.bubble.ai strong{color:var(--bright);}
.bubble.ai ul{padding-left:1.1rem;margin:0.4rem 0;}
.bubble.ai li{margin-bottom:0.3rem;}
.bubble.ai a{color:var(--leaf);text-decoration:none;}
.bubble.ai a:hover{text-decoration:underline;}
.bubble.ai .tip{
  background:rgba(122,182,72,0.07);border-left:3px solid var(--leaf);
  padding:0.6rem 0.9rem;border-radius:0 0.5rem 0.5rem 0;
  margin:0.7rem 0;font-size:0.82rem;color:var(--sage);
}
.bubble.ai .tip strong{color:var(--cream);display:block;margin-bottom:0.2rem;}
.bubble.ai .shop-cta{
  display:inline-flex;align-items:center;gap:0.5rem;
  background:rgba(122,182,72,0.1);border:1px solid rgba(122,182,72,0.25);
  color:var(--leaf);padding:0.5rem 1rem;border-radius:0.5rem;
  font-size:0.78rem;margin-top:0.7rem;text-decoration:none;cursor:pointer;
  transition:all 0.2s;font-family:'DM Sans',sans-serif;
}
.bubble.ai .shop-cta:hover{background:rgba(122,182,72,0.18);}

.msg-time{font-size:0.62rem;color:rgba(122,182,72,0.25);font-family:'IBM Plex Mono',monospace;}

/* Typing indicator */
.typing-bubble{
  display:none;align-items:center;gap:0.9rem;
  animation:msgIn 0.3s ease forwards;
}
.typing-bubble.show{display:flex;}
.typing-dots{
  background:rgba(10,26,12,0.8);border:1px solid var(--line);
  border-radius:1rem 1rem 1rem 0.2rem;padding:0.9rem 1.2rem;
  display:flex;gap:0.4rem;align-items:center;
}
.typing-dots span{
  width:6px;height:6px;border-radius:50%;background:var(--sage);
  animation:dot 1.4s ease infinite;
}
.typing-dots span:nth-child(2){animation-delay:0.2s;}
.typing-dots span:nth-child(3){animation-delay:0.4s;}
@keyframes dot{0%,80%,100%{transform:scale(0.7);opacity:0.4;}40%{transform:scale(1);opacity:1;}}

/* ‚îÄ‚îÄ INPUT AREA ‚îÄ‚îÄ */
.input-wrap{
  padding:1rem 1.8rem 1.4rem;
  border-top:1px solid var(--line);
  background:rgba(6,14,8,0.85);
  backdrop-filter:blur(20px);
  flex-shrink:0;
}

.input-row{
  display:flex;align-items:flex-end;gap:0.7rem;
  background:rgba(10,26,12,0.8);border:1.5px solid var(--line);
  border-radius:0.9rem;padding:0.7rem 0.7rem 0.7rem 1.1rem;
  transition:border-color 0.2s;
}
.input-row:focus-within{border-color:rgba(122,182,72,0.35);}

#userInput{
  flex:1;background:none;border:none;outline:none;
  color:var(--cream);font-family:'DM Sans',sans-serif;font-size:0.88rem;
  line-height:1.5;resize:none;max-height:120px;min-height:24px;
}
#userInput::placeholder{color:rgba(122,182,72,0.28);}

.send-btn{
  width:36px;height:36px;border-radius:0.6rem;
  background:var(--leaf);border:none;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  flex-shrink:0;transition:all 0.2s;
  color:var(--forest);
}
.send-btn:hover{background:var(--bright);transform:scale(1.05);}
.send-btn:disabled{background:var(--line);cursor:default;transform:none;}

.input-footer{
  display:flex;justify-content:space-between;align-items:center;
  margin-top:0.6rem;font-size:0.65rem;color:rgba(122,182,72,0.25);
  font-family:'IBM Plex Mono',monospace;
}

/* ‚îÄ‚îÄ MOBILE SIDEBAR TOGGLE ‚îÄ‚îÄ */
.mob-sidebar-btn{
  display:none;background:none;border:1px solid var(--line);
  color:var(--sage);padding:0.3rem 0.6rem;border-radius:0.4rem;
  cursor:pointer;font-size:0.75rem;
}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:768px){
  .sidebar{position:fixed;top:0;left:-280px;bottom:0;width:280px;z-index:100;transition:left 0.35s ease;}
  .sidebar.open{left:0;}
  .mob-sidebar-btn{display:flex;align-items:center;gap:0.4rem;}
  .messages{padding:1.2rem 1rem;}
  .msg-body{max-width:88%;}
  .input-wrap{padding:0.8rem 1rem 1rem;}
  .welcome{padding:2rem 1rem;}
  .topbar{padding:0.8rem 1rem;}
  .brand-sub{display:none;}
}
</style>
</head>
<body>

<div class="ambient amb-1"></div>
<div class="ambient amb-2"></div>

<!-- TOPBAR -->
<div class="topbar">
  <div class="brand">
    <div class="brand-icon">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <ellipse cx="10" cy="8.5" rx="7" ry="6" fill="#7ab648" opacity="0.9"/>
        <ellipse cx="10" cy="6" rx="5" ry="4.5" fill="#0d2818" opacity="0.5"/>
        <rect x="9" y="13" width="2" height="6" rx="1" fill="#5c3d1e"/>
      </svg>
    </div>
    <div>
      <div class="brand-name">Adverse AI</div>
      <div class="brand-sub">Elite Tree Solutions ¬∑ Agriculture Advisor</div>
    </div>
  </div>

  <div class="status">
    <div class="status-dot"></div>
    <span>Online ¬∑ Uganda Agriculture Expert</span>
  </div>

  <div class="topbar-actions">
    <button class="btn-ghost mob-sidebar-btn" onclick="toggleSidebar()">‚ò∞ Topics</button>
    <button class="btn-ghost" onclick="clearChat()" title="Clear conversation">‚Ü∫ Clear</button>
    <a href="index.html" class="btn-home">‚Üê Site</a>
  </div>
</div>

<!-- MAIN -->
<div class="main">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-label">Ask me about</div>
      <div class="sq-list">
        <div class="sq-item" onclick="askQuestion('What is the best fruit tree to plant in Uganda right now?')">Best fruit tree for Uganda right now</div>
        <div class="sq-item" onclick="askQuestion('My avocado leaves are turning yellow. What is wrong?')">My avocado leaves are yellowing</div>
        <div class="sq-item" onclick="askQuestion('When is the best time to plant trees in Uganda?')">Best planting time in Uganda</div>
        <div class="sq-item" onclick="askQuestion('How do I identify and treat termites on my mango tree?')">Termites on my mango tree</div>
        <div class="sq-item" onclick="askQuestion('What fertiliser should I use for my fruit trees?')">Which fertiliser for fruit trees</div>
        <div class="sq-item" onclick="askQuestion('How do I plant a grafted seedling correctly?')">How to plant a grafted seedling</div>
        <div class="sq-item" onclick="askQuestion('What trees grow best in Kampala gardens?')">Best trees for Kampala gardens</div>
        <div class="sq-item" onclick="askQuestion('How much does a grafted mango seedling cost?')">Price of a grafted mango</div>
      </div>
    </div>

    <div>
      <div class="sidebar-section" style="padding-bottom:0.5rem;">
        <div class="sidebar-label">I can help with</div>
      </div>
      <div class="cap-list">
        <div class="cap-item"><div class="cap-dot"></div>Tree species identification & selection</div>
        <div class="cap-item"><div class="cap-dot"></div>Uganda planting seasons & climate zones</div>
        <div class="cap-item"><div class="cap-dot"></div>Pest & disease diagnosis</div>
        <div class="cap-item"><div class="cap-dot"></div>Fertilising & soil preparation</div>
        <div class="cap-item"><div class="cap-dot"></div>Pruning, watering & care schedules</div>
        <div class="cap-item"><div class="cap-dot"></div>Pricing & availability at the nursery</div>
        <div class="cap-item"><div class="cap-dot"></div>Booking & consultation advice</div>
      </div>
    </div>

    <div class="tree-ref">
      <div class="sidebar-label" style="margin-bottom:0.6rem;">Quick tree lookup</div>
      <div id="treePills"></div>
    </div>
  </aside>

  <!-- CHAT -->
  <div class="chat-wrap">
    <div class="messages" id="messages">

      <!-- WELCOME STATE -->
      <div class="welcome" id="welcomeScreen">
        <div class="welcome-icon">
          <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
            <ellipse cx="20" cy="16" rx="13" ry="11" fill="#7ab648" opacity="0.9"/>
            <ellipse cx="20" cy="12" rx="9" ry="8" fill="#0d2818" opacity="0.5"/>
            <rect x="18.5" y="25" width="3" height="12" rx="1.5" fill="#5c3d1e"/>
          </svg>
        </div>
        <h1>Ask <em>Adverse AI</em></h1>
        <p>Your personal Uganda agriculture advisor. Ask me anything about trees, planting, pests, soil and care ‚Äî I know every species at the Kabimbiri nursery.</p>
        <div class="welcome-chips">
          <div class="chip" onclick="askQuestion('What fruit trees are most profitable in Uganda?')">üçã Most profitable fruit trees</div>
          <div class="chip" onclick="askQuestion('My tree has white powder on the leaves. What is it?')">üçÉ White powder on leaves</div>
          <div class="chip" onclick="askQuestion('How do I water trees in the dry season?')">üíß Dry season watering</div>
          <div class="chip" onclick="askQuestion('What is the difference between grafted and seedling trees?')">üå± Grafted vs seedling</div>
          <div class="chip" onclick="askQuestion('Which trees are good for shade in a school compound?')">üè´ Shade trees for schools</div>
          <div class="chip" onclick="askQuestion('How much mulch should I put around a young tree?')">üåø How to mulch correctly</div>
        </div>
      </div>

    </div>

    <!-- Typing indicator (outside messages for positioning) -->
    <div style="padding:0 2rem 0.5rem;" id="typingWrap">
      <div class="typing-bubble" id="typingBubble">
        <div class="msg-avatar ai">AI</div>
        <div class="typing-dots">
          <span></span><span></span><span></span>
        </div>
      </div>
    </div>

    <!-- INPUT -->
    <div class="input-wrap">
      <div class="input-row">
        <textarea id="userInput" placeholder="Ask about trees, pests, planting, pricing‚Ä¶" rows="1"
          onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()" title="Send">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M14 8 L2 2 L5 8 L2 14 L14 8Z" fill="currentColor"/>
          </svg>
        </button>
      </div>
      <div class="input-footer">
        <span>Adverse AI ¬∑ Powered by Claude ¬∑ For agriculture only</span>
        <span id="charCount">0 / 500</span>
      </div>
    </div>
  </div>

</div>

<script>
// ‚îÄ‚îÄ TREE INVENTORY (from Elite Tree Solutions shop) ‚îÄ‚îÄ
const TREES = [
  {name:'Apple Mango',cat:'Fruit',price:18000,type:'grafted',desc:'Sweet, round, popular'},
  {name:'Kent Mango',cat:'Fruit',price:22000,type:'grafted',desc:'Late-season, export quality'},
  {name:'Haden Mango',cat:'Fruit',price:15000,type:'grafted',desc:'Disease-resistant'},
  {name:'Hass Avocado',cat:'Fruit',price:25000,type:'grafted',desc:'Global gold standard'},
  {name:'Fuerte Avocado',cat:'Fruit',price:20000,type:'grafted',desc:'Mid-altitude workhorse'},
  {name:'Washington Navel Orange',cat:'Fruit',price:18000,type:'grafted',desc:'Seedless, sweet'},
  {name:'Eureka Lemon',cat:'Fruit',price:16000,type:'grafted',desc:'Year-round fruiting'},
  {name:'Jackfruit',cat:'Fruit',price:20000,type:'grafted',desc:"Uganda's giant fruit"},
  {name:'Guava',cat:'Fruit',price:12000,type:'grafted',desc:'Fast-bearing, nutritious'},
  {name:'Passion Fruit',cat:'Fruit',price:10000,type:'grafted',desc:'Commercial vine'},
  {name:'Pawpaw / Papaya',cat:'Fruit',price:6000,type:'seedling',desc:'Fast tropical fruit'},
  {name:'Tamarind',cat:'Fruit',price:22000,type:'grafted',desc:'Sweet pods, long-lived'},
  {name:'Matooke Banana',cat:'Fruit',price:8000,type:'seedling',desc:"Uganda's staple"},
  {name:'Coconut Palm',cat:'Fruit',price:15000,type:'seedling',desc:'High value nuts'},
  {name:'Natal Fig',cat:'Shade',price:18000,type:'seedling',desc:'Beloved community tree'},
  {name:'African Mahogany',cat:'Shade',price:25000,type:'seedling',desc:'Stately hardwood'},
  {name:'Neem Tree',cat:'Shade',price:10000,type:'seedling',desc:'Fast, medicinal'},
  {name:'Moringa',cat:'Shade',price:8000,type:'seedling',desc:'Nutritional superfood'},
  {name:'Umbrella Thorn Acacia',cat:'Shade',price:15000,type:'seedling',desc:'Iconic silhouette'},
  {name:'Cape Chestnut',cat:'Shade',price:22000,type:'seedling',desc:'Pink flowering canopy'},
  {name:'Musizi / White Stinkwood',cat:'Shade',price:20000,type:'seedling',desc:'Native premium timber'},
  {name:'East African Yellowwood',cat:'Shade',price:28000,type:'seedling',desc:'Extremely long-lived'},
  {name:'Jacaranda',cat:'Ornamental',price:20000,type:'seedling',desc:'Purple flowering'},
  {name:'Flamboyant / Flame Tree',cat:'Ornamental',price:18000,type:'seedling',desc:'Blazing red display'},
  {name:'Frangipani',cat:'Ornamental',price:22000,type:'seedling',desc:'Heavenly scented'},
  {name:'African Tulip',cat:'Ornamental',price:16000,type:'seedling',desc:'Orange Uganda native'},
  {name:'Bougainvillea',cat:'Ornamental',price:12000,type:'seedling',desc:'Year-round colour'},
  {name:'Pride of India',cat:'Ornamental',price:24000,type:'seedling',desc:'Purple flowering'},
  {name:'Yellow Cassia',cat:'Ornamental',price:16000,type:'seedling',desc:'Golden cascades'},
  {name:'Bottle Brush',cat:'Ornamental',price:14000,type:'seedling',desc:'Red brush flowers'},
  {name:'Weeping Fig',cat:'Ornamental',price:18000,type:'seedling',desc:'Classic avenue tree'},
  {name:'Mvule / African Teak',cat:'Native',price:30000,type:'seedling',desc:"Uganda's prized timber"},
  {name:'Elgon Olive',cat:'Native',price:28000,type:'seedling',desc:'Native Ugandan olive'},
  {name:'Prunus africana',cat:'Native',price:32000,type:'seedling',desc:'Medicinal bark'},
  {name:'Strangler Fig',cat:'Native',price:18000,type:'seedling',desc:'Sacred village tree'},
  {name:'Warburgia',cat:'Native',price:35000,type:'seedling',desc:'Uganda endemic, medicinal'},
  {name:'Markhamia',cat:'Native',price:14000,type:'seedling',desc:'Fast native shade'},
  {name:'Albizia',cat:'Native',price:16000,type:'seedling',desc:'Nitrogen-fixing'},
  {name:'Royal Palm',cat:'Palm',price:45000,type:'seedling',desc:'Majestic avenue palm'},
  {name:'Date Palm',cat:'Palm',price:38000,type:'seedling',desc:'Productive date palm'},
  {name:'Fan Palm',cat:'Palm',price:30000,type:'seedling',desc:'Dramatic fan fronds'},
  {name:'Bamboo Palm',cat:'Palm',price:25000,type:'seedling',desc:'Elegant multi-stem'},
];

const TREE_INVENTORY = TREES.map(t =>
  `${t.name} (${t.cat}, ${t.type}, UGX ${t.price.toLocaleString()})`
).join('\n');

// ‚îÄ‚îÄ SYSTEM PROMPT ‚îÄ‚îÄ
const SYSTEM_PROMPT = `You are Adverse AI ‚Äî the agriculture and tree advisor for Elite Tree Solutions, a premier tree nursery in Kabimbiri, Kayunga Road, Uganda, owned by Kakuye Hitler Musajja (phone: +256 706 191 725).

You speak in Kakuye's voice: warm, expert, Ugandan, like a deeply knowledgeable farmer friend who genuinely loves trees. You are confident, practical, and specific. You occasionally use gentle warmth ("That's a great question for this season", "Many farmers in Buganda ask me this").

FOCUS: You ONLY answer questions about:
- Tree species selection, identification, characteristics
- Uganda agriculture, soils, climate zones, planting seasons
- Pest & disease diagnosis and treatment
- Fertilising, watering, pruning, mulching, soil preparation
- Pricing, availability and recommendations from our nursery
- Booking consultations or visiting the nursery

If asked about ANYTHING unrelated (politics, general AI, personal topics, etc.), politely say: "I only know trees ‚Äî ask me anything about planting, pests or species and I'll give you my best advice."

OUR NURSERY INVENTORY (42 species, all available now at Kabimbiri):
${TREE_INVENTORY}

UGANDA CONTEXT:
- Two rainy seasons: Long rains March‚ÄìMay (main planting season), Short rains September‚ÄìNovember
- Dry seasons: December‚ÄìFebruary and June‚ÄìAugust
- Central region soils: Red loam, generally pH 5.5‚Äì6.8
- Altitude ranges: 900‚Äì1,300m in Buganda region
- Key pests: Termites, aphids, scale insects, fruit flies, bacterial wilt, anthracnose

PRICING CONTEXT:
- All prices are in UGX (Ugandan Shillings)
- Grafted seedlings are 2-3x more expensive than seedlings but fruit 2-3 years earlier
- Bulk discounts available for orders of 50+ trees
- Delivery available nationwide ‚Äî quote on WhatsApp

FORMATTING:
- Use short paragraphs. Never write walls of text.
- Use **bold** for key terms, tree names, and important tips.
- Use bullet lists for multi-point answers.
- End practical answers with a relevant tip box using this format: [TIP: your tip here]
- When a tree from our inventory is relevant, mention its price naturally.
- If someone needs hands-on help, suggest: "For a proper assessment, book a consultation with me ‚Äî I can visit your farm directly."
- For purchases, end with: [SHOP: link text] and I'll convert it to a button.

Keep responses focused and under 250 words unless a detailed guide is genuinely needed.`;

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let history = [];
let isLoading = false;

// ‚îÄ‚îÄ RENDER TREE PILLS ‚îÄ‚îÄ
function renderPills(){
  const wrap = document.getElementById('treePills');
  const cats = [...new Set(TREES.map(t=>t.cat))];
  cats.forEach(cat=>{
    const catTrees = TREES.filter(t=>t.cat===cat);
    const label = document.createElement('div');
    label.style.cssText='font-size:0.58rem;text-transform:uppercase;letter-spacing:0.12em;color:rgba(122,182,72,0.3);margin:0.7rem 0 0.3rem;font-family:"IBM Plex Mono",monospace;';
    label.textContent = cat + ' Trees';
    wrap.appendChild(label);
    catTrees.forEach(t=>{
      const pill = document.createElement('button');
      pill.className='tree-pill';
      pill.textContent=t.name;
      pill.onclick=()=>askQuestion(`Tell me about ${t.name} ‚Äî how to grow it in Uganda and what it costs.`);
      wrap.appendChild(pill);
    });
  });
}

// ‚îÄ‚îÄ FORMAT AI RESPONSE ‚îÄ‚îÄ
function formatResponse(text){
  let html = text
    // Bold
    .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
    // Tip boxes
    .replace(/\[TIP:\s*(.*?)\]/g,'<div class="tip"><strong>üí° Tip</strong>$1</div>')
    // Shop CTAs
    .replace(/\[SHOP:\s*(.*?)\]/g,'<a class="shop-cta" href="shop.html">üå± $1</a>')
    // Headings (### )
    .replace(/^###\s+(.+)$/gm,'<h3>$1</h3>')
    // Bullet points
    .replace(/^[-‚Ä¢]\s+(.+)$/gm,'<li>$1</li>')
    // Numbered lists
    .replace(/^\d+\.\s+(.+)$/gm,'<li>$1</li>')
    // Wrap consecutive <li> in <ul>
    .replace(/(<li>.*<\/li>\n?)+/g, match => `<ul>${match}</ul>`)
    // Line breaks to paragraphs
    .split('\n\n').filter(p=>p.trim()).map(p=>{
      if(p.startsWith('<h3>')||p.startsWith('<ul>')||p.startsWith('<div class="tip">')||p.startsWith('<a class="shop')) return p;
      return `<p>${p.replace(/\n/g,'<br>')}</p>`;
    }).join('');
  return html;
}

// ‚îÄ‚îÄ TIME FORMAT ‚îÄ‚îÄ
function timeNow(){
  return new Date().toLocaleTimeString('en-UG',{hour:'2-digit',minute:'2-digit'});
}

// ‚îÄ‚îÄ ADD MESSAGE TO UI ‚îÄ‚îÄ
function addMessage(role, content, raw=false){
  const welcome = document.getElementById('welcomeScreen');
  if(welcome) welcome.remove();

  const messages = document.getElementById('messages');
  const isAI = role === 'assistant';

  const msg = document.createElement('div');
  msg.className = `msg ${isAI?'':'user'}`;

  const avatarLabel = isAI ? 'AI' : 'üë§';
  const avatarClass = isAI ? 'ai' : 'user';
  const bubbleClass = isAI ? 'ai' : 'user';
  const bubbleContent = (isAI && !raw) ? formatResponse(content) : `<p>${content.replace(/</g,'&lt;')}</p>`;

  msg.innerHTML = `
    <div class="msg-avatar ${avatarClass}">${avatarLabel}</div>
    <div class="msg-body">
      <div class="bubble ${bubbleClass}">${bubbleContent}</div>
      <div class="msg-time">${timeNow()}</div>
    </div>`;

  messages.appendChild(msg);
  messages.scrollTop = messages.scrollHeight;
  return msg;
}

// ‚îÄ‚îÄ TYPING INDICATOR ‚îÄ‚îÄ
function showTyping(show){
  document.getElementById('typingBubble').classList.toggle('show', show);
  const wrap = document.getElementById('messages');
  if(show) wrap.scrollTop = wrap.scrollHeight;
}

// ‚îÄ‚îÄ SEND MESSAGE ‚îÄ‚îÄ
async function sendMessage(){
  const input = document.getElementById('userInput');
  const text = input.value.trim();
  if(!text || isLoading) return;

  input.value = '';
  autoResize(input);
  document.getElementById('charCount').textContent = '0 / 500';

  addMessage('user', text, true);
  history.push({role:'user', content:text});

  isLoading = true;
  document.getElementById('sendBtn').disabled = true;
  showTyping(true);

  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':'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','anthropic-version':'2023-06-01','anthropic-dangerous-allow-browser':'true'},
      body: JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:1000,
        system: SYSTEM_PROMPT,
        messages: history
      })
    });

    const data = await response.json();
    showTyping(false);

    if(data.content && data.content[0]){
      const reply = data.content[0].text;
      history.push({role:'assistant', content:reply});
      addMessage('assistant', reply);
    } else {
      throw new Error('No response');
    }
  } catch(err){
    showTyping(false);
    addMessage('assistant', "I'm having a moment of silence üåø ‚Äî please try again in a few seconds.", true);
    history.pop();
  }

  isLoading = false;
  document.getElementById('sendBtn').disabled = false;
  document.getElementById('userInput').focus();
}

// ‚îÄ‚îÄ ASK PRESET QUESTION ‚îÄ‚îÄ
function askQuestion(q){
  document.getElementById('userInput').value = q;
  sendMessage();
  // Close sidebar on mobile
  document.getElementById('sidebar').classList.remove('open');
}

// ‚îÄ‚îÄ KEYBOARD HANDLER ‚îÄ‚îÄ
function handleKey(e){
  if(e.key === 'Enter' && !e.shiftKey){
    e.preventDefault();
    sendMessage();
  }
}

// ‚îÄ‚îÄ AUTO RESIZE TEXTAREA ‚îÄ‚îÄ
function autoResize(el){
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 120) + 'px';
  const len = el.value.length;
  document.getElementById('charCount').textContent = len + ' / 500';
  if(len > 500) el.value = el.value.slice(0,500);
}

// ‚îÄ‚îÄ CLEAR CHAT ‚îÄ‚îÄ
function clearChat(){
  history = [];
  const messages = document.getElementById('messages');
  messages.innerHTML = `
    <div class="welcome" id="welcomeScreen">
      <div class="welcome-icon">
        <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
          <ellipse cx="20" cy="16" rx="13" ry="11" fill="#7ab648" opacity="0.9"/>
          <ellipse cx="20" cy="12" rx="9" ry="8" fill="#0d2818" opacity="0.5"/>
          <rect x="18.5" y="25" width="3" height="12" rx="1.5" fill="#5c3d1e"/>
        </svg>
      </div>
      <h1>Ask <em>Adverse AI</em></h1>
      <p>Your personal Uganda agriculture advisor. Ask me anything about trees, planting, pests, soil and care.</p>
      <div class="welcome-chips">
        <div class="chip" onclick="askQuestion('What fruit trees are most profitable in Uganda?')">üçã Most profitable fruit trees</div>
        <div class="chip" onclick="askQuestion('My tree has white powder on the leaves. What is it?')">üçÉ White powder on leaves</div>
        <div class="chip" onclick="askQuestion('How do I water trees in the dry season?')">üíß Dry season watering</div>
        <div class="chip" onclick="askQuestion('What is the difference between grafted and seedling trees?')">üå± Grafted vs seedling</div>
        <div class="chip" onclick="askQuestion('Which trees are good for shade in a school compound?')">üè´ Shade trees for schools</div>
        <div class="chip" onclick="askQuestion('How much mulch should I put around a young tree?')">üåø How to mulch correctly</div>
      </div>
    </div>`;
}

// ‚îÄ‚îÄ MOBILE SIDEBAR ‚îÄ‚îÄ
function toggleSidebar(){
  document.getElementById('sidebar').classList.toggle('open');
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
renderPills();
document.getElementById('userInput').focus();
</script>
</body>
</html>
